<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moje Osobn√≠ Str√°nka - Ji≈ô√≠k</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
     /* Reset a z√°kladn√≠ styly */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding-top: 70px; /* V√Ω≈°ka hlaviƒçky, aby obsah nezaƒç√≠nal pod n√≠ */
    text-align: center;
}

:root {
    --header-bg-color: rgba(0,0,0,0.1); 
    --text-color: white;
    --border-color: rgba(255,255,255,0.2);
    --secondary-text-color: rgba(255,255,255,0.8);
    --nav-bg-color: rgba(0,0,0,0.3);
    --primary-gradient: linear-gradient(45deg, #667eea, #764ba2);
    --secondary-gradient: linear-gradient(45deg, #42a5f5, #1e88e5);
    --danger-gradient: linear-gradient(45deg, #ef5350, #e53935);
}

header {
    background-color: var(--header-bg-color);
    color: var(--text-color);
    text-align: center;
    padding: 2rem 1rem;
    border-bottom: 1px solid var(--border-color);
    margin-top: -40px;
}
header h1 {
    font-size: 2.5em;
    text-align: center;
    margin-top: -45px;
    margin-bottom: 0.5rem;
}
header p {
    font-size: 1.1em;
    color: var(--secondary-text-color);
}

nav { 
    background-color: var(--nav-bg-color);
    padding: 0.5rem 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.nav-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.logo {
    font-size: 1.8rem;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.nav-link {
    color: white;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    font-size: 0.9rem;
}

.nav-link:hover, .nav-link.active {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#loading-indicator {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 1rem 2rem;
    border-radius: 10px;
    z-index: 10000;
    font-size: 1.1rem;
}

.hidden {
    display: none !important;
}
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

main {
    padding: 2rem 0;
    margin-top: 140px; 
    min-height: calc(100vh - 140px - 70px);
    margin-top: -20px;
    width: 100%;
}

.container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 1rem;
    margin-top: -20px;
    width: 100%;
}

section {
    display: none;
    background: rgba(255, 255, 255, 0.95);
    margin: 1rem 0;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    width: 100%;
}

section.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

section h2, section h3 {
    color: #333;
    margin-bottom: 1rem;
}

section h1 {
    font-size: 2.5rem;
    text-align: center;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-fill-color: transparent;
}
section h2 {
    font-size: 2rem;
    border-bottom: 2px solid #667eea;
    padding-bottom: 0.5rem;
    color: #4a5568;
}

.editor-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
    width: 100%;
}

#html-editor {
    width: 100%;
    height: 400px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 1rem;
    resize: vertical;
    background-color: #fdfdfd;
    color: #333;
}

#html-preview {
    width: 100%;
    height: 400px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
}

.button, button {
    background: var(--primary-gradient);
    color: white !important; 
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 25px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: bold;
    transition: all 0.3s ease;
    margin: 0.5rem;
    text-decoration: none; 
    display: inline-block;
}

.button:hover, button:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}

.btn-secondary {
    background: var(--secondary-gradient);
}

.btn-danger {
    background: var(--danger-gradient);
}

.gallery-controls {
    margin-bottom: 2rem;
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
    width: 100%;
}

#newImageUrl {
    flex: 1;
    min-width: 200px;
    padding: 0.75rem;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    color: #333;
}

#gallery-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
    width: 100%;
}

.gallery-image-wrapper {
    position: relative;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
    background-color: #e0e0e0;
}

.gallery-image-wrapper:hover {
    transform: scale(1.05);
}

.gallery-image-wrapper img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    cursor: pointer;
    display: block;
}

.delete-img-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(220,53,69,0.8); 
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}
.delete-img-btn:hover {
    background: #b02a37; 
}

.saved-code-item {
    background: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
}

.saved-code-item:hover {
    background: #e9ecef;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}
.item-header h3 {
    color: #667eea;
    font-size: 1.25rem;
    margin-bottom: 0;
}

.actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}
.actions .button {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

/* Kompletn√≠ transformace tabulky na permanentn√≠ grid */

/* Z√°kladn√≠ styl pro tabulku */
#links-table {
    width: 100%;
    max-width: 1400px;
    margin: 1rem auto 0 auto;
    border-collapse: separate;
    background: #f8fafc;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

/* Skryj thead √∫plnƒõ - u≈æ ho nepot≈ôebujeme */
#links-table thead {
    display: none;
}

/* Transformuj tbody na grid kontejner */
#links-table tbody {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1.5rem;
    padding: 2rem;
    background: #f8fafc;
}

/* Ka≈æd√Ω ≈ô√°dek (tr) jako grid kartiƒçka */
#links-table tbody tr {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    background: white;
    border-radius: 12px;
    padding: 1.5rem 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
    min-height: 140px;
}

/* Hover efekt pro kartiƒçky */
#links-table tbody tr:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
    border-color: #667eea;
    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
}

/* Reset v≈°ech td styl≈Ø */
#links-table tbody td {
    border: none;
    padding: 0;
    text-align: center;
    width: 100%;
}

/* Ikona - prvn√≠ bu≈àka */
#links-table tbody td:nth-child(1) {
    font-size: 2rem;
    margin-bottom: 0.8rem;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 50px;
}

/* N√°zev odkazu - druh√° bu≈àka */
#links-table tbody td:nth-child(2) {
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.8rem;
    font-size: 1rem;
    line-height: 1.2;
    min-height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* URL adresa - t≈ôet√≠ bu≈àka */
#links-table tbody td:nth-child(3) {
    font-size: 0.75rem;
    color: #718096;
    word-break: break-all;
    line-height: 1.3;
    margin-bottom: auto;
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

#links-table tbody td:nth-child(3) a {
    color: #5a67d8;
    text-decoration: none;
    transition: color 0.2s ease;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    background: rgba(90, 103, 216, 0.1);
}

#links-table tbody td:nth-child(3) a:hover {
    color: #434190;
    text-decoration: underline;
    background: rgba(90, 103, 216, 0.2);
}

/* Akce tlaƒç√≠tka - ƒçtvrt√° bu≈àka (edit mode) */
#links-table tbody td:nth-child(4) {
    margin-top: 1rem;
    display: flex;
    gap: 0.5rem;
    justify-content: center;
}

.edit-mode-only {
    display: none;
}

/* Kdy≈æ je edit mode aktivn√≠ */
body.edit-mode .edit-mode-only {
    display: flex;
}

body.edit-mode #links-table tbody tr {
    min-height: 180px; /* V√≠ce m√≠sta pro tlaƒç√≠tka */
}

/* Responzivn√≠ design */
@media (max-width: 1300px) {
    #links-table tbody {
        grid-template-columns: repeat(5, 1fr);
        gap: 1.2rem;
    }
}

@media (max-width: 1100px) {
    #links-table tbody {
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
    }
}

@media (max-width: 900px) {
    #links-table tbody {
        grid-template-columns: repeat(3, 1fr);
        padding: 1.5rem;
    }
}

@media (max-width: 600px) {
    #links-table tbody {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
        padding: 1rem;
    }
    
    #links-table tbody tr {
        padding: 1rem 0.5rem;
        min-height: 120px;
    }
}

@media (max-width: 400px) {
    #links-table tbody {
        grid-template-columns: 1fr;
    }
}
.modal { 
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6); 
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000; 
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0s linear 0.3s;
}

.modal.visible {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    max-width: 90%;
    width: 90%;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    transform: scale(0.95);
    transition: transform 0.3s ease;
}
.modal.visible .modal-content {
    transform: scale(1);
}

.modal input[type="text"], .modal input[type="url"], .modal input[type="email"], .modal input[type="password"] { 
    width: 100%;
    padding: 0.75rem;
    margin: 1rem 0;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    color: #333;
}
.modal .modal-buttons { 
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

#image-modal { 
    background: rgba(0,0,0,0.9);
}

#image-modal .modal-content {
    background: transparent;
    max-width: 95%;
    max-height: 95%;
    padding: 0;
    box-shadow: none; 
}

#modal-img {
    max-width: 100%;
    max-height: 80vh;
    border-radius: 10px;
    display: block;
    margin: auto;
}

.modal-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 1rem;
    width: 100%;
    max-width: 100%; 
    margin-left: auto;
    margin-right: auto;
}

.modal-nav button {
    background: rgba(255,255,255,0.15);
    color: white;
    border: none;
    padding: 0.8rem; 
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.5rem; 
    width: 50px; 
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}
.modal-nav button:hover {
    background: rgba(255,255,255,0.3);
}

footer {
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    color: white;
    text-align: center;
    padding: 2rem 0;
    position: relative;
    width: 100%;
}

#user-id-display { 
    background: rgba(255,255,255,0.1);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem; 
    color: white;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    display: inline-block;
    margin-top: 0.5rem;
}
#user-id-display span {
    font-weight: bold;
}

/* Nov√© styly pro editaci inline obsahu */
[contenteditable="true"] {
    outline: 2px dashed rgba(102, 126, 234, 0.5); /* Modr√Ω r√°meƒçek pro editovateln√© prvky */
    padding: 2px;
    min-width: 1em; /* Zaruƒçuje, ≈æe pr√°zdn√Ω prvek je st√°le viditeln√Ω */
    transition: outline 0.2s ease;
}
[contenteditable="true"]:hover {
    outline-color: rgba(102, 126, 234, 0.8);
}
[contenteditable="true"]:focus {
    outline: 2px solid #667eea; /* Pevn√Ω modr√Ω r√°meƒçek p≈ôi aktivn√≠ editaci */
    background-color: rgba(255, 255, 255, 0.8);
}

.edit-controls {
    position: absolute;
    top: 5px;
    right: 5px;
    display: flex;
    gap: 5px;
    z-index: 10;
}

.edit-controls button {
    padding: 5px 8px;
    font-size: 0.8em;
    border-radius: 5px;
    background-color: rgba(0, 0, 0, 0.6);
    color: white;
    cursor: pointer;
    border: none;
    transition: background-color 0.2s;
}

.edit-controls button:hover {
    background-color: rgba(0, 0, 0, 0.8);
}

.editable-image-wrapper {
    position: relative;
    display: inline-block; /* Aby obal reagoval na velikost obr√°zku */
}
.editable-image-wrapper .edit-icon {
    position: absolute;
    top: 5px;
    left: 5px;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.2em;
    transition: background-color 0.2s;
    z-index: 5;
}
.editable-image-wrapper .edit-icon:hover {
    background-color: rgba(0, 0, 0, 0.9);
}

.editable-link {
    position: relative;
    display: inline-block;
    margin-right: 20px; /* M√≠sto pro edit ikonu */
}
.editable-link .edit-icon {
    position: absolute;
    right: -20px; /* Posune ikonu vedle odkazu */
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.8em;
    transition: background-color 0.2s;
    z-index: 5;
}
.editable-link .edit-icon:hover {
    background-color: rgba(0, 0, 0, 0.9);
}

/* Skryt√≠/Zobrazen√≠ editaƒçn√≠ch prvk≈Ø */
body:not(.edit-mode) [contenteditable="true"],
body:not(.edit-mode) .edit-controls,
body:not(.edit-mode) .delete-img-btn,
body:not(.edit-mode) #data-management,
body:not(.edit-mode) #addImageUrlBtn,
body:not(.edit-mode) #newImageUrl,
body:not(.edit-mode) #save-code-btn,
body:not(.edit-mode) .actions .button,
body:not(.edit-mode) .editable-image-wrapper .edit-icon,
body:not(.edit-mode) .editable-link .edit-icon,
body:not(.edit-mode) .edit-mode-only { /* NOVINKA: Skr√Ωv√°me i edit-mode-only prvky */
    display: none !important;
}

/* Nov√° t≈ô√≠da pro zobrazen√≠ edit m√≥du */
body.edit-mode #edit-mode-toggle-btn {
    display: block; /* Zobraz√≠ tlaƒç√≠tko "Zav≈ô√≠t" */
}
body.edit-mode .edit-controls,
body.edit-mode .delete-img-btn,
body.edit-mode #data-management,
body.edit-mode #addImageUrlBtn,
body.edit-mode #newImageUrl,
body.edit-mode #save-code-btn,
body.edit-mode .actions .button,
body.edit-mode .editable-image-wrapper .edit-icon,
body.edit-mode .editable-link .edit-icon {
    display: flex; /* Zobraz√≠ ostatn√≠ editaƒçn√≠ prvky */
}
body.edit-mode .editable-image-wrapper .edit-icon,
body.edit-mode .editable-link .edit-icon {
    display: flex; /* Specificky pro ikony */
}
body.edit-mode .edit-mode-only { /* NOVINKA: Zobrazujeme edit-mode-only prvky v edit m√≥du */
    display: table-cell !important; /* Pro bu≈àky tabulky */
}

/* KOMPLETN√ç MEDIA QUERIES PRO PLNOU ≈†√ç≈òKU */

/* Tablet landscape a vƒõt≈°√≠ */
@media (min-width: 768px) {
    .editor-container {
        grid-template-columns: 1fr 1fr;
    }
    
    .container {
        padding: 0 2rem;
    }
    
    section {
        padding: 2rem;
        margin: 2rem 0;
    }
    
    #gallery-container {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
}

/* Tablet portrait a men≈°√≠ - DVOU≈ò√ÅDKOV√Å NAVIGACE + VYLEP≈†EN√â ODKAZY */
@media (max-width: 767px) {
    body {
        padding-top: 0;
    }
    
    .container {
        max-width: 100%;
        padding: 0 0.5rem;
        margin: 0;
    }
    
    .nav-container {
        padding: 0 0.5rem;
        /* KL√çƒåOV√Å ZMƒöNA: Vytvo≈ô√≠me grid layout pro dvou≈ô√°dkovou navigaci */
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 0.5rem;
        justify-items: center;
        align-items: center;
    }
    
    header {
        position: relative;
        padding: 1rem 0.5rem;
        margin-top: 0;
    }
    
    header h1 { 
        font-size: 2rem; 
        margin-top: 0;
    }
    
    header p { 
        font-size: 1rem; 
    }

    nav {
        position: relative;
        top: 0;
        padding: 1rem 0; /* Zvƒõt≈°en√Ω padding pro dvou≈ô√°dkovou navigaci */
    }

    .nav-link {
        padding: 0.6rem 0.8rem;
        font-size: 0.85rem;
        margin: 0; /* Odstran√≠me margin, proto≈æe pou≈æ√≠v√°me grid gap */
        width: 100%; /* Tlaƒç√≠tka vypln√≠ celou ≈°√≠≈ôku grid bu≈àky */
        text-align: center;
        white-space: nowrap; /* Zabr√°n√≠me zalomen√≠ textu */
        overflow: hidden;
        text-overflow: ellipsis; /* P≈ôid√°me t≈ôi teƒçky p≈ôi p≈ôekroƒçen√≠ */
    }
    
    main {
        margin-top: 0;
        padding: 1rem 0;
        width: 100%;
    }

    section {
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 10px;
        width: 100%;
    }

    section h1 {
        font-size: 1.8rem;
    }
    
    section h2 {
        font-size: 1.5rem;
    }
    
    .editor-container {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    #html-editor, #html-preview {
        height: 300px;
    }
    
    .gallery-controls {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    #newImageUrl {
        width: 100%;
        min-width: auto;
    }
    
    #gallery-container {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.5rem;
    }
    
    .item-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .actions {
        width: 100%;
        justify-content: flex-start;
    }
    
    /* VYLEP≈†EN√â EXTERN√ç ODKAZY */
    #links-table {
        font-size: 0.9rem;
        display: table;
        overflow-x: auto;
        width: 100%;
        table-layout: fixed; /* Fixn√≠ layout pro lep≈°√≠ kontrolu ≈°√≠≈ôek */
    }
    
    #links-table th,
    #links-table td {
        padding: 0.5rem;
        white-space: nowrap;
        overflow: hidden; /* Skryje obsah, kter√Ω p≈ôeteƒçe */
        text-overflow: ellipsis; /* P≈ôid√° t≈ôi teƒçky */
        max-width: 0; /* Umo≈æn√≠ fungov√°n√≠ ellipsis */
    }
    
    /* Specifick√© ≈°√≠≈ôky pro sloupce */
    #links-table th:first-child,
    #links-table td:first-child {
        width: 30%; /* N√°zev */
        min-width: 80px;
    }
    
    #links-table th:nth-child(2),
    #links-table td:nth-child(2) {
        width: 50%; /* URL - nejvƒõt≈°√≠ prostor */
        min-width: 120px;
    }
    
    #links-table th:last-child,
    #links-table td:last-child {
        width: 20%; /* Popis */
        min-width: 60px;
    }
    
    /* Pro odkazy v bu≈àk√°ch */
    #links-table a {
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 100%;
    }
    
    .modal-content {
        width: 95%;
        padding: 1.5rem;
        margin: 1rem;
    }
    
    .modal .modal-buttons {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .modal-nav {
        padding: 0 1rem;
    }
}

/* Mobiln√≠ za≈ô√≠zen√≠ - TAK√â S DVOU≈ò√ÅDKOVOU NAVIGAC√ç + VYLEP≈†EN√â ODKAZY */
@media (max-width: 480px) {
    .container {
        padding: 0 0.25rem;
    }
    
    .nav-container {
        padding: 0 0.25rem;
        /* Zachov√°v√°me grid layout i pro mobiln√≠ za≈ô√≠zen√≠ */
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 0.3rem;
        justify-items: center;
        align-items: center;
    }
    
    .nav-link {
        font-size: 0.75rem;
        padding: 0.5rem 0.4rem;
        margin: 0;
        width: 100%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    header {
        padding: 0.5rem 0.25rem;
    }
    
    header h1 {
        font-size: 1.5rem;
    }
    
    header p {
        font-size: 0.9rem;
    }
    
    nav {
        padding: 0.8rem 0; /* P≈ôizp≈Øsoben√Ω padding pro men≈°√≠ obrazovky */
    }
    
    section {
        padding: 0.75rem;
        margin: 0.25rem 0;
    }
    
    section h1 {
        font-size: 1.5rem;
    }
    
    section h2 {
        font-size: 1.3rem;
    }
    
    #gallery-container {
        grid-template-columns: 1fr 1fr;
    }
    
    .gallery-image-wrapper img {
        height: 150px;
    }
    
    .button, button {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        margin: 0.25rem;
        width: auto;
    }
    
    .modal-content {
        padding: 1rem;
        width: 98%;
        margin: 0.5rem;
    }
    
    .modal input[type="text"], 
    .modal input[type="url"], 
    .modal input[type="email"], 
    .modal input[type="password"] {
        font-size: 16px; /* Zabra≈àuje zoomov√°n√≠ na iOS */
        padding: 0.75rem;
    }
    
    /* VYLEP≈†EN√â EXTERN√ç ODKAZY PRO MOBIL */
    #links-table {
        font-size: 0.8rem;
        display: table;
        overflow-x: auto;
        width: 100%;
        table-layout: fixed;
    }
    
    #links-table th,
    #links-table td {
        padding: 0.25rem;
        white-space: nowrap;
        overflow: hidden; /* Skryje obsah, kter√Ω p≈ôeteƒçe */
        text-overflow: ellipsis; /* P≈ôid√° t≈ôi teƒçky */
        max-width: 0; /* Umo≈æn√≠ fungov√°n√≠ ellipsis */
    }
    
    /* Upraven√© ≈°√≠≈ôky pro mobiln√≠ */
    #links-table th:first-child,
    #links-table td:first-child {
        width: 25%; /* N√°zev - men≈°√≠ */
        min-width: 60px;
    }
    
    #links-table th:nth-child(2),
    #links-table td:nth-child(2) {
        width: 55%; /* URL - v√≠ce prostoru */
        min-width: 100px;
    }
    
    #links-table th:last-child,
    #links-table td:last-child {
        width: 20%; /* Popis */
        min-width: 50px;
    }
    
    /* Pro odkazy v bu≈àk√°ch */
    #links-table a {
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 100%;
    }
    
    .modal-nav button {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
}

/* Velmi mal√© displeje - TAK√â S DVOU≈ò√ÅDKOVOU NAVIGAC√ç + SKRYT√ù POPIS U ODKAZ≈Æ */
@media (max-width: 320px) {
    .container {
        padding: 0 0.1rem;
    }
    
    .nav-container {
        padding: 0 0.1rem;
        /* Grid layout z≈Øst√°v√° i pro velmi mal√© displeje */
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 0.2rem;
        justify-items: center;
        align-items: center;
    }
    
    .nav-link {
        font-size: 0.7rem;
        padding: 0.4rem 0.2rem;
        margin: 0;
        width: 100%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    nav {
        padding: 0.6rem 0;
    }
    
    header h1 {
        font-size: 1.3rem;
    }
    
    section {
        padding: 0.5rem;
    }
    
    #gallery-container {
        grid-template-columns: 1fr;
    }
    
    /* EXTR√âMN√ç OPTIMALIZACE ODKAZ≈Æ PRO VELMI MAL√â DISPLEJE */
    #links-table {
        font-size: 0.75rem;
        display: table;
        overflow-x: auto;
        width: 100%;
        table-layout: fixed;
    }
    
    #links-table th,
    #links-table td {
        padding: 0.2rem;
        white-space: nowrap;
        overflow: hidden; /* Skryje obsah, kter√Ω p≈ôeteƒçe */
        text-overflow: ellipsis; /* P≈ôid√° t≈ôi teƒçky */
        max-width: 0; /* Umo≈æn√≠ fungov√°n√≠ ellipsis */
    }
    
    /* Extr√©mnƒõ mal√© displeje - skryjeme popis √∫plnƒõ */
    #links-table th:last-child,
    #links-table td:last-child {
        display: none; /* Skryje sloupec s popisem */
    }
    
    /* P≈ôerozdƒõl√≠me prostor mezi n√°zev a URL */
    #links-table th:first-child,
    #links-table td:first-child {
        width: 35%; /* N√°zev */
        min-width: 70px;
    }
    
    #links-table th:nth-child(2),
    #links-table td:nth-child(2) {
        width: 65%; /* URL - maximum prostoru */
        min-width: 120px;
    }
    
    /* Pro odkazy v bu≈àk√°ch */
    #links-table a {
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 100%;
    }
}
/* Z√ÅKLADN√ç STYL PRO DATA MANAGEMENT KONTEJNER */
.function-setupDataManagement {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 1rem;
    margin: 1rem auto; /* P≈òID√ÅNO/ZMƒöNA: Nastavuje automatick√© okraje vlevo a vpravo pro centrov√°n√≠ */
    max-width: 600px; /* P≈òID√ÅNO: Nastavuje maxim√°ln√≠ ≈°√≠≈ôku kontejneru, aby se mohl vycentrovat.
                       * Tuto hodnotu bude≈° muset P≈òIZP≈ÆSOBIT, aby se na r≈Øzn√Ωch za≈ô√≠zen√≠ch ve≈°el grid.
                       */
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    position: relative;
    overflow: hidden;
}

.data-management-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    justify-items: center;
    align-items: center;
    padding: 0 1rem;
    /* D≈ÆLE≈ΩIT√â: Ujisti se, ≈æe tento kontejner m√° 100% ≈°√≠≈ôku uvnit≈ô sv√©ho rodiƒçe,
       aby se grid spr√°vnƒõ roztahoval. */
    width: 100%; /* P≈òID√ÅNO: Zajist√≠, ≈æe grid zabere celou ≈°√≠≈ôku rodiƒçe */
}

.function-setupDataManagement::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg,
        rgba(255, 255, 255, 0.1) 0%,
        transparent 50%,
        rgba(255, 255, 255, 0.1) 100%);
    pointer-events: none;
}

.function-setupDataManagement .button {
    padding: 0.8rem 1rem;
    font-size: 0.9rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
    white-space: nowrap; /* Ponech√°no podle tv√©ho po≈æadavku, ale m≈Ø≈æe zp≈Øsobit p≈ôet√©k√°n√≠ */
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    text-align: center;
    font-weight: 500;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.function-setupDataManagement .btn-primary {
    background: rgba(76, 175, 80, 0.9);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.function-setupDataManagement .btn-danger {
    background: rgba(244, 67, 54, 0.9);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.function-setupDataManagement .btn-secondary {
    background: rgba(63, 81, 181, 0.9);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.function-setupDataManagement .button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
}

.function-setupDataManagement .btn-primary:hover {
    background: rgba(76, 175, 80, 1);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

.function-setupDataManagement .btn-danger:hover {
    background: rgba(244, 67, 54, 1);
    box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
}

.function-setupDataManagement .btn-secondary:hover {
    background: rgba(63, 81, 181, 1);
    box-shadow: 0 5px 15px rgba(63, 81, 181, 0.4);
}

/* KOMPLETN√ç MEDIA QUERIES PRO DATA MANAGEMENT */

/* Tablet landscape a vƒõt≈°√≠ */
@media (min-width: 768px) {
    .function-setupDataManagement {
        padding: 1.5rem 2rem;
        margin: 2rem auto; /* P≈òID√ÅNO/ZMƒöNA: Auto margin pro centrov√°n√≠ */
        max-width: 800px; /* P≈òID√ÅNO/ZMƒöNA: Upravit pro centrov√°n√≠ na vƒõt≈°√≠ch obrazovk√°ch */
    }
    
    .data-management-container {
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        padding: 0 1rem;
    }
    
    .function-setupDataManagement .button {
        padding: 1rem 1.2rem;
        font-size: 1rem;
    }
}

/* Tablet portrait a men≈°√≠ - DVOU≈ò√ÅDKOV√ù LAYOUT */
@media (max-width: 767px) {
    .function-setupDataManagement {
        padding: 1rem 0.5rem;
        margin: 1rem auto; /* P≈òID√ÅNO/ZMƒöNA: Auto margin pro centrov√°n√≠ */
        max-width: 400px; /* P≈òID√ÅNO/ZMƒöNA: Upravit pro centrov√°n√≠ na men≈°√≠ch obrazovk√°ch */
    }
    
    .data-management-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Zachov√°no repeat(4, 1fr) podle tv√©ho po≈æadavku */
        
        gap: 0.8rem;
        justify-items: center;
        align-items: center;
        padding: 0 0.5rem;
    }
    
    .function-setupDataManagement .button {
        padding: 0.8rem 1rem;
        font-size: 0.85rem;
        margin: 0;
        width: 100%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
}

/* Mobiln√≠ za≈ô√≠zen√≠ - TAK√â DVOU≈ò√ÅDKOV√ù LAYOUT */
@media (max-width: 480px) {
    .function-setupDataManagement {
        padding: 0.8rem 0.25rem;
        margin: 0.8rem auto; /* P≈òID√ÅNO/ZMƒöNA: Auto margin pro centrov√°n√≠ */
        max-width: 425px; /* P≈òID√ÅNO/ZMƒöNA: Upravit pro centrov√°n√≠ na mal√Ωch mobilen√≠ch obrazovk√°ch */
    }
    
    .data-management-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Zachov√°no repeat(4, 1fr) podle tv√©ho po≈æadavku */
        
        gap: 0.6rem;
        justify-items: center;
        align-items: center;
        padding: 0 0.25rem;
    }
    
    .function-setupDataManagement .button {
        font-size: 0.75rem;
        padding: 0.7rem 0.8rem;
        margin: 0;
        width: 100%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
}

/* Velmi mal√© displeje - DVOU≈ò√ÅDKOV√ù LAYOUT S MINIM√ÅLN√çMI ROZMƒöRY */
@media (max-width: 320px) {
    .function-setupDataManagement {
        padding: 0.6rem 0.1rem;
        margin: 0.6rem auto; /* P≈òID√ÅNO/ZMƒöNA: Auto margin pro centrov√°n√≠ */
        max-width: 200px; /* P≈òID√ÅNO/ZMƒöNA: Upravit pro centrov√°n√≠ na velmi mal√Ωch obrazovk√°ch */
    }
    
    .data-management-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Zachov√°no repeat(4, 1fr) podle tv√©ho po≈æadavku */
        
        gap: 0.4rem;
        justify-items: center;
        align-items: center;
        padding: 0 0.1rem;
    }
    
    .function-setupDataManagement .button {
        font-size: 0.7rem;
        padding: 0.6rem 0.4rem;
        margin: 0;
        width: 100%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
}
        /* modals.css (nebo style.css) */

/* === MODAL OKNA CSS === */

/* Z√°kladn√≠ modal overlay */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

/* Modal aktivn√≠ stav */
.modal.active {
    opacity: 1;
    visibility: visible;
}

/* Modal obsah */
.modal-content {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border: 2px solid #00ffff;
    border-radius: 15px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: 
        0 10px 30px rgba(0, 255, 255, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    color: #ffffff;
    position: relative;
    transform: scale(0.7);
    transition: transform 0.3s ease;
    text-align: center;
}

/* Modal content animace p≈ôi aktivaci */
.modal.active .modal-content {
    transform: scale(1);
}

/* Modal nadpis */
.modal-content h3 {
    color: #00ffff;
    margin-bottom: 20px;
    font-size: 1.4rem;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

/* Modal input pole */
.modal-content input {
    width: 100%;
    padding: 12px;
    margin: 15px 0;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid #333;
    border-radius: 8px;
    color: #ffffff;
    font-size: 1rem;
    font-family: 'Courier New', monospace;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    caret-color: #00ffff;
}

.modal-content input:focus {
    outline: none;
    border-color: #00ffff;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    animation: input-glow 2s infinite;
}

.modal-content input::placeholder {
    color: #888;
}

/* Animace pro input kdy≈æ je aktivn√≠ */
@keyframes input-glow {
    0%, 100% {
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    50% {
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
    }
}

/* Blikaj√≠c√≠ kurzor efekt pro input */
.modal-content input:focus {
    outline: none;
    border-color: #00ffff;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    animation: input-glow 2s infinite, caret-blink 1s infinite;
}

/* Blik√°n√≠ kurzoru v input poli */
@keyframes caret-blink {
    0%, 50% {
        caret-color: #00ffff;
    }
    51%, 100% {
        caret-color: transparent;
    }
}

/* Error zpr√°va */
.error-message {
    color: #ff4444;
    font-size: 0.9rem;
    margin: 10px 0;
    text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
    min-height: 20px;
}

/* Modal tlaƒç√≠tka kontejner */
.modal-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 25px;
    flex-wrap: wrap;
}

/* Modal tlaƒç√≠tka z√°kladn√≠ styl */
.modal-actions .button {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 100px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Prim√°rn√≠ tlaƒç√≠tko (OK) */
.modal-actions .btn-primary {
    background: linear-gradient(135deg, #00ffff 0%, #0088ff 100%);
    color: #000;
    box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
}

.modal-actions .btn-primary:hover {
    background: linear-gradient(135deg, #33ffff 0%, #0099ff 100%);
    box-shadow: 0 6px 20px rgba(0, 255, 255, 0.5);
    transform: translateY(-2px);
}

/* Sekund√°rn√≠ tlaƒç√≠tko (Zru≈°it) */
.modal-actions .btn-secondary {
    background: linear-gradient(135deg, #666 0%, #444 100%);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.modal-actions .btn-secondary:hover {
    background: linear-gradient(135deg, #777 0%, #555 100%);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    transform: translateY(-2px);
}

/* Zav√≠rac√≠ k≈ô√≠≈æek (pokud bude≈° cht√≠t p≈ôidat) */
.modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    color: #888;
    font-size: 24px;
    cursor: pointer;
    transition: color 0.3s ease;
}

.modal-close:hover {
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

/* Responsivn√≠ design pro mobily */
@media (max-width: 600px) {
    .modal-content {
        margin: 20px;
        padding: 20px;
        max-width: none;
        width: calc(100% - 40px);
    }
    
    .modal-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .modal-actions .button {
        width: 100%;
        max-width: 200px;
    }
}

/* Animace pro loading stav */
.modal-loading {
    pointer-events: none;
}

.modal-loading .modal-content {
    opacity: 0.7;
}

.modal-loading .button {
    opacity: 0.5;
    cursor: not-allowed;
}
    </style>
</head>
<body style="visibility: hidden;">
    <div id="loading-indicator" class="hidden">Naƒç√≠t√°n√≠...</div>

    <header>
        <h1 data-editable="header-title">V√≠tejte na m√© osobn√≠ str√°nce!</h1>
        <p data-editable="header-subtitle">Ji≈ô√≠k a jeho digit√°ln√≠ kr√°lovstv√≠</p>
    </header>

    <nav>
        <div id="data-management"></div>
        <div class="nav-container">
            <a href="#" class="nav-link" data-section="about">O mnƒõ</a>
            <a href="#" class="nav-link" data-section="portfolio">Portfolio</a>
            <a href="#" class="nav-link" data-section="contacts">Kontakty</a>
            <a href="#" class="nav-link" data-section="editor">HTML Editor</a>
            <a href="#" class="nav-link" data-section="saved">Moje HTML k√≥dy</a>
            <a href="#" class="nav-link" data-section="gallery">Galerie</a>
            <a href="#" class="nav-link" data-section="links">Odkazy</a>
            <button id="edit-mode-toggle-btn" class="button hidden" onclick="toggleEditMode()">Zav≈ô√≠t</button>
            <button id="login-button" class="button" onclick="showAuthModal()">Upravit</button>
        </div>
    </nav>
    <div id="local-password-modal" class="modal">
    <div class="modal-content">
        <h3>Zadejte p≈ô√≠stupov√© heslo</h3>
        <input type="password" id="local-password-input" placeholder="Heslo">
        <p id="local-password-error" class="error-message"></p> 
        <div class="modal-actions">
            <button id="local-password-ok-btn" class="button btn-primary">OK</button>
            <button id="local-password-cancel-btn" class="button btn-secondary">Zru≈°it</button>
        </div>
    </div>
</div>
            
               <!-- Tlaƒç√≠tka spr√°vy dat - ready to copy -->
    
<div class="function-setupDataManagement">
    <div class="data-management-container">
        <button id="save-all-data-btn" class="button btn-primary" >üíæ Ulo≈æit v≈°e</button>
        <button id="clear-all-data-btn" class="button btn-danger" >üóëÔ∏è Vymazat v≈°e</button>
        <button id="export-data-btn" class="button btn-secondary" >üì§ Export</button>
        <button id="import-data-btn" class="button btn-secondary" >üì• Import</button>
    </div>
    <input type="file" id="import-file-input" accept=".json" style="display: none;">
</div>
    <main>
        <div class="container">
            <section id="about">
                <h2 data-editable="about-h2">O mnƒõ</h2>
                <p data-editable="about-intro"><strong>Ji≈ô√≠ Med ‚Äì Milovn√≠k techniky a z√°bavy</strong></p>
                <div>
                    <h3 data-editable="about-h3-1">Co r√°d dƒõl√°m o voln√Ωch chv√≠l√≠ch:</h3>
                    <p data-editable="about-text-1"><strong>Hran√≠ poƒç√≠taƒçov√Ωch her:</strong> Jsem fanou≈°ek hern√≠ho svƒõta, kde se r√°d pono≈ô√≠m do r≈Øzn√Ωch virtu√°ln√≠ch svƒõt≈Ø. A≈• u≈æ je to akce, strategie nebo RPG, poƒç√≠taƒçov√© hry mƒõ bav√≠ a pom√°haj√≠ mi vypnout. Hern√≠ svƒõt mi d√°v√° prostor pro dobrodru≈æstv√≠, v√Ωzvy a rozvoj strategie.</p>
                    <p data-editable="about-text-2"><strong>Sledov√°n√≠ YouTube vide√≠:</strong> Kdy≈æ zrovna nehraju hry, u≈æ√≠v√°m si sledov√°n√≠ vide√≠ na YouTube. Zaj√≠maj√≠ mƒõ hern√≠ let‚Äôs playe, technick√© novinky a videa obl√≠ben√Ωch vlogger≈Ø, kter√° mƒõ inspiruj√≠ a obƒças rozesmƒõj√≠. YouTube je pro mƒõ z√°bavou i zdrojem nov√Ωch n√°pad≈Ø.</p>
                </div>
                <div>
                    <h3 data-editable="about-h3-2">Dal≈°√≠ z√°jmy:</h3>
                    <p data-editable="about-text-3"><strong>Star Trek:</strong> Moje v√°≈°e≈à pro sci-fi svƒõt Star Treku je obrovsk√°. Miluju tento seri√°l i jeho postavy, kter√© mƒõ prov√°zej√≠ u≈æ od dƒõtstv√≠. Vlastn√≠m projekt vƒõnovan√Ω Star Treku, kde kombinuji svou l√°sku k tomuto univerzu s technick√Ωmi znalostmi. Futuristick√© technologie a warpov√© efekty jsou pro mƒõ fascinuj√≠c√≠, a dokonce jsem je zaƒçlenil do sv√©ho webov√©ho projektu.</p>
                    <p data-editable="about-text-4"><strong>Technika a k√≥dov√°n√≠:</strong> Jsem nad≈°enec do technologi√≠ a r√°d pracuju na r≈Øzn√Ωch technick√Ωch v√Ωzv√°ch. Programov√°n√≠ a √∫prava HTML a CSS jsou moj√≠ v√°≈°n√≠, proto≈æe mƒõ bav√≠ vytv√°≈ôet funkƒçn√≠ a esteticky kr√°sn√© webov√© str√°nky. M√°m cit pro detail a r√°d kombinuju modern√≠ design s inovativn√≠mi funkcemi.</p>
                </div>
                <div>
                    <h3 data-editable="about-h3-3">Styl ≈æivota:</h3>
                    <p data-editable="about-text-5">R√°d tr√°v√≠m ƒças u poƒç√≠taƒçe, a≈• u≈æ p≈ôi hran√≠, tvorbƒõ web≈Ø nebo sledov√°n√≠ vide√≠. Miluju barevn√© LED p√°sky a osvƒõtlen√≠, kter√© blik√° do rytmu hudby, co≈æ p≈ôin√°≈°√≠ skvƒõlou atmosf√©ru do m√©ho prostoru. Tato kombinace techniky a estetiky mi dod√°v√° inspiraci a vytv√°≈ô√≠ m√≠sto, kde se c√≠t√≠m dob≈ôe.</p>
                </div>
            </section>

            <section id="portfolio">
                <h2 data-editable="portfolio-h2">Portfolio</h2>
                <p data-editable="portfolio-intro">V t√©to sekci najde≈° uk√°zky m√Ωch projekt≈Ø a pr√°ce, kter√© odr√°≈æej√≠ m√© z√°jmy v oblasti technologi√≠. I kdy≈æ nejsem program√°tor, d√≠ky spolupr√°ci s AI, jako je ChatGPT a Claude.AI, se mi poda≈ôilo vytvo≈ôit tyto projekty, na kter√© jsem py≈°n√Ω.</p>
                <div class="portfolio-items" style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div class="portfolio-item" data-item-id="star-trek-project" style="background-color: #f9f9f9; padding: 1rem; border-radius: 4px; border: 1px solid #ddd; position: relative;">
                        <h3 data-editable="portfolio-item-1-title">Star Trek Webov√Ω Projekt</h3>
                        <p data-editable="portfolio-item-1-desc">Tento projekt je vƒõnov√°n m√©mu obl√≠ben√©mu sci-fi seri√°lu Star Trek. D√≠ky pomoci od chatbot≈Ø ChatGPT a Claude.AI jsem vytvo≈ôil interaktivn√≠ webovou str√°nku s animacemi warp pohonu, seznamy postav a kl√≠ƒçov√Ωmi momenty ze v≈°ech s√©ri√≠. Str√°nka je responzivn√≠ a p≈ôizp≈Øsob√≠ se jak√©mukoli za≈ô√≠zen√≠, co≈æ navozuje pocit, jako bys byl p≈ô√≠mo ve vesm√≠ru.</p>
                        <a href="https://jirka22med.github.io/star-trek-universe/" class="button editable-link" data-link-id="star-trek-link" data-editable-link-text="Zobrazit projekt &rarr;"><i class="fas fa-edit edit-icon"></i></a>
                        <div class="edit-controls hidden">
                            <button onclick="editPortfolioItem('star-trek-project')">Editovat</button>
                        </div>
                    </div>
                    <div class="portfolio-item" data-item-id="audio-led-project" style="background-color: #f9f9f9; padding: 1rem; border-radius: 4px; border: 1px solid #ddd; position: relative;">
                        <h3 data-editable="portfolio-item-2-title">Audio a LED projekty</h3>
                        <p data-editable="portfolio-item-2-desc-1">Tento projekt je skvƒõl√Ωm p≈ô√≠kladem m√©ho praktick√©ho p≈ô√≠stupu k technice. Vzal jsem dva reproduktory Lamax Storm 1, kter√© jsem rozebral, a odpojil jsem u nich jeden z mal√Ωch vnit≈ôn√≠ch reproduktor≈Ø...</p>
                        <p data-editable="portfolio-item-2-desc-2">Cel√Ω syst√©m je postaven na jednoduch√©m principu: zvukov√© sign√°ly, kter√© norm√°lnƒõ poh√°nƒõj√≠ reproduktory, jsou p≈ôesmƒõrov√°ny tak, aby poh√°nƒõly osvƒõtlen√≠...</p>
                        <a href="#" class="button editable-link" data-link-id="audio-led-link" data-editable-link-text="V√≠ce o projektu &rarr;"><i class="fas fa-edit edit-icon"></i></a>
                        <div class="edit-controls hidden">
                            <button onclick="editPortfolioItem('audio-led-project')">Editovat</button>
                        </div>
                    </div>
                    <div class="portfolio-item" data-item-id="web-design-coding" style="background-color: #f9f9f9; padding: 1rem; border-radius: 4px; border: 1px solid #ddd; position: relative;">
                        <h3 data-editable="portfolio-item-3-title">Webov√Ω design a k√≥dov√°n√≠</h3>
                        <p data-editable="portfolio-item-3-desc">I kdy≈æ se nepova≈æuji za program√°tora, d√≠ky AI jsem zvl√°dl tvorbu responzivn√≠ch webov√Ωch str√°nek s modern√≠m designem. M√°m nƒõkolik projekt≈Ø, kter√© vyu≈æ√≠vaj√≠ HTML, CSS a JavaScript, a kter√© mi pomohla vytvo≈ôit umƒõl√° inteligence.</p>
                        <a href="#" class="button editable-link" data-link-id="web-design-link" data-editable-link-text="Prohl√©dnout si uk√°zky &rarr;"><i class="fas fa-edit edit-icon"></i></a>
                        <div class="edit-controls hidden">
                            <button onclick="editPortfolioItem('web-design-coding')">Editovat</button>
                        </div>
                    </div>
                </div>
                <button id="add-portfolio-item-btn" class="button hidden">P≈ôidat polo≈æku do portfolia</button>
            </section>

            <section id="contacts">
                <h2 data-editable="contacts-h2">Kontakty</h2>
                <p data-editable="contacts-intro">Zde m≈Ø≈æete p≈ôidat sv√© kontaktn√≠ √∫daje, jako je e-mail, odkazy na soci√°ln√≠ s√≠tƒõ (nap≈ô. Discord, GitHub) nebo jin√© zp≈Øsoby, jak v√°s mohou lid√© oslovit.</p>
                <div class="contact-details" style="margin-top: 1rem;">
                    <p><strong>E-mail:</strong> <a href="mailto:tvuj.email@example.com" data-link-id="contact-email" data-editable-link-text="tvuj.email@example.com" class="editable-link"><i class="fas fa-edit edit-icon"></i></a></p>
                    <p><strong>Discord:</strong> <span data-editable="contact-discord">TvojeJmeno#1234</span></p>
                </div>
                <div id="user-id-display" class="hidden">Va≈°e User ID: <span id="firebase-user-id"></span></div>
            </section>

            <section id="editor">
                <h2>HTML Editor</h2>
                <div class="editor-container">
                    <div>
                        <label for="html-editor">HTML K√≥d:</label>
                        <textarea id="html-editor" placeholder="Zde pi≈°te sv≈Øj HTML k√≥d..."></textarea>
                    </div>
                    <div>
                        <label for="html-preview">N√°hled:</label>
                        <iframe id="html-preview"></iframe>
                    </div>
                </div>
                <button id="save-code-btn">Ulo≈æit k√≥d</button>
            </section>

            <section id="saved">
                <h2>Moje HTML k√≥dy</h2>
                <div id="saved-codes-list">
                    <p>Naƒç√≠t√°n√≠ ulo≈æen√Ωch k√≥d≈Ø...</p>
                </div>
            </section>

            <section id="gallery">
                <h2>Galerie</h2>
                <div class="gallery-controls">
                    <input type="url" id="newImageUrl" placeholder="Vlo≈æte URL adresu obr√°zku...">
                    <button id="addImageUrlBtn" class="button">P≈ôidat obr√°zek</button>
                </div>
                <div id="gallery-container">
                    <p>Naƒç√≠t√°n√≠ obr√°zk≈Ø...</p>
                </div>
            </section>

            <section id="links">
                <h2>Extern√≠ Odkazy</h2>
                <table id="links-table">
                    <thead>
                        <tr>
                            <th>Ikona</th>
                            <th>N√°zev odkazu</th>
                            <th>Adresa URL</th>
                            <th class="edit-mode-only">Akce</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Odkazy se budou generovat zde -->
                    </tbody>
                </table>
                <button id="add-link-btn" class="button hidden">P≈ôidat odkaz</button>
            </section>
        </div>
    </main>

    <footer>
        <p>&copy; <span id="currentYear"></span> <span data-editable="footer-copyright-name">Ji≈ô√≠ Med</span>. V≈°echna pr√°va vyhrazena.</p>
        <p data-editable="footer-slogan">Inspirov√°no technologiemi a budoucnost√≠.</p>
    </footer>

    <!-- Modals (stejn√© jako v p≈Øvodn√≠m k√≥du) -->
    <div id="image-modal" class="modal">
        <div class="modal-content">
            <img id="modal-img" src="" alt="Zvƒõt≈°en√Ω obr√°zek">
            <div class="modal-nav">
                <button id="prev-image-btn" class="button btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    P≈ôedchoz√≠
                </button>
                <button id="close-modal-btn" class="button btn-danger">Zav≈ô√≠t</button>
                <button id="next-image-btn" class="button btn-secondary">
                    Dal≈°√≠
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                </button>
            </div>
        </div>
    </div>

    <div id="save-code-modal" class="modal">
        <div class="modal-content">
            <h3>Ulo≈æit HTML k√≥d</h3>
            <label for="code-title-input">N√°zev k√≥du:</label>
            <input type="text" id="code-title-input" placeholder="Nap≈ô. M≈Øj √∫≈æasn√Ω snippet">
            <div class="modal-buttons">
                <button id="cancel-save-code-btn" class="button btn-secondary">Zru≈°it</button>
                <button id="confirm-save-code-btn" class="button">Ulo≈æit</button>
            </div>
        </div>
    </div>
    
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <h3 id="alert-modal-title">Upozornƒõn√≠</h3>
            <p id="alert-modal-message"></p>
            <div class="modal-buttons">
                <button id="alert-modal-ok-btn" class="button">OK</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <h3 id="confirm-modal-title">Potvrzen√≠</h3>
            <p id="confirm-modal-message"></p>
            <div class="modal-buttons">
                <button id="confirm-modal-cancel-btn" class="button btn-secondary">Zru≈°it</button>
                <button id="confirm-modal-ok-btn" class="button btn-danger">Potvrdit</button>
            </div>
    </div>
</div>

<div id="auth-modal" class="modal">
    <div class="modal-content">
        <h3>P≈ôihl√°≈°en√≠ / Registrace</h3>
        <label for="auth-email">Email:</label>
        <input type="email" id="auth-email" placeholder="vas.email@example.com">
        <label for="auth-password">Heslo:</label>
        <input type="password" id="auth-password" placeholder="********">
        <div class="modal-buttons">
            <button id="login-auth-btn" class="button">P≈ôihl√°sit se</button>
            <button id="signup-auth-btn" class="button btn-secondary">Registrovat se</button>
            <button id="cancel-auth-btn" class="button btn-danger">Zru≈°it</button>
        </div>
        <p id="auth-error-message" style="color: red; margin-top: 10px;"></p>
    </div>
</div>

<div id="edit-image-modal" class="modal">
    <div class="modal-content">
        <h3>Upravit obr√°zek</h3>
        <label for="edit-image-url">URL obr√°zku:</label>
        <input type="url" id="edit-image-url" placeholder="https://example.com/obrazek.jpg">
        <label for="edit-image-name">N√°zev obr√°zku:</label>
        <input type="text" id="edit-image-name" placeholder="Popis obr√°zku">
        <div class="modal-buttons">
            <button id="cancel-edit-image-btn" class="button btn-secondary">Zru≈°it</button>
            <button id="save-edit-image-btn" class="button">Ulo≈æit</button>
        </div>
    </div>
</div>

<div id="edit-link-modal" class="modal">
    <div class="modal-content">
        <h3>Upravit odkaz</h3>
        <label for="edit-link-title">N√°zev odkazu:</label>
        <input type="text" id="edit-link-title" placeholder="N√°zev odkazu">
        <label for="edit-link-url">URL odkazu:</label>
        <input type="url" id="edit-link-url" placeholder="https://example.com">
        <div class="modal-buttons">
            <button id="cancel-edit-link-btn" class="button btn-secondary">Zru≈°it</button>
            <button id="save-edit-link-btn" class="button">Ulo≈æit</button>
        </div>
    </div>
</div>

<div id="edit-portfolio-modal" class="modal">
    <div class="modal-content">
        <h3>Upravit polo≈æku portfolia</h3>
        <label for="edit-portfolio-title">N√°zev:</label>
        <input type="text" id="edit-portfolio-title" placeholder="N√°zev projektu">
        <label for="edit-portfolio-desc-1">Popis 1:</label>
        <textarea id="edit-portfolio-desc-1" rows="5" placeholder="Popis projektu"></textarea>
        <label for="edit-portfolio-desc-2">Popis 2 (voliteln√©):</label>
        <textarea id="edit-portfolio-desc-2" rows="5" placeholder="Dal≈°√≠ popis"></textarea>
        <label for="edit-portfolio-link-text">Text tlaƒç√≠tka odkazu:</label>
        <input type="text" id="edit-portfolio-link-text" placeholder="Text tlaƒç√≠tka">
        <label for="edit-portfolio-link-url">URL odkazu:</label>
        <input type="url" id="edit-portfolio-link-url" placeholder="https://">
        <div class="modal-buttons">
            <button id="cancel-edit-portfolio-btn" class="button btn-secondary">Zru≈°it</button>
            <button id="save-edit-portfolio-btn" class="button">Ulo≈æit</button>
            <button id="delete-portfolio-btn" class="button btn-danger hidden">Smazat polo≈æku</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
   // javascript.js
// Obsahuje ve≈°kerou logiku webov√© str√°nky s integrac√≠ Firebase pro synchronizaci dat.

// --- Supabase Konstanty ---
const SUPABASE_URL = 'https://aknjpurxdbtsxillmqbd.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrbmpwdXJ4ZGJ0c3hpbGxtcWJkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxOTEzMzAsImV4cCI6MjA2Mzc2NzMzMH0.otk-74BBM-SwC_zA0WqqcwGVab5lBfrLiyeYOmh4Xio';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Glob√°ln√≠ promƒõnn√° pro stav editaƒçn√≠ho m√≥du
let isEditMode = false;
const EDIT_MODE_KEY = 'portfolio_edit_mode_active'; // Kl√≠ƒç pro ulo≈æen√≠ stavu edit m√≥du

// --- Firebase Konfigurace a inicializace ---
// ZDE NAHRAƒé SV√â VLASTN√ç FIREBASE KONFIGURAƒåN√ç √öDAJE!
const firebaseConfig = {
    apiKey: "AIzaSyCu5iBjQg01lxiiGpB-eXi4_N7kb4WLs4E",
    authDomain: "fir-test-2bb95.firebaseapp.com",
    projectId: "fir-test-2bb95",
    storageBucket: "fir-test-2bb95.firebasestorage.app",
    messagingSenderId: "494805653679",
    appId: "1:494805653679:web:1b7d0b024a388aaf711c5a",
    // measurementId: "YOUR_MEASUREMENT_ID" // Pokud pou≈æ√≠v√°≈° Analytics
    databaseURL: "https://fir-test-2bb95-default-rtdb.firebaseio.com/", // <--- TOTO MUS√ç B√ùT P≈òESNƒö TAKHLE
};

// Inicializuj Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database(); // Z√≠sk√°n√≠ instance Realtime Database

// Ukl√°d√°n√≠ dat na Firebase
// Data budou ulo≈æena pod cestou users/<supabase_user_id>/portfolio_data
// To zajist√≠, ≈æe ka≈æd√Ω p≈ôihl√°≈°en√Ω u≈æivatel m√° sv√° vlastn√≠ data.
let currentSupabaseUserId = null; // Zde budeme dr≈æet ID aktu√°lnƒõ p≈ôihl√°≈°en√©ho u≈æivatele

function getFirebaseDataPath(userId) {
    if (!userId) {
        console.warn("Attempted to get Firebase data path without a user ID. Data will be saved to a generic path (not user-specific).");
        return 'public_portfolio_data'; // Fallback pro test, pokud nen√≠ user ID
    }
    return `users/${userId}/portfolio_data`;
}

// Funkce pro naƒç√≠t√°n√≠ dat z Firebase
async function loadDataFromFirebase() {
    if (!currentSupabaseUserId) {
        console.warn("User not logged in, skipping Firebase data load.");
        return;
    }
    showLoading("Naƒç√≠t√°m data z vesm√≠ru...");
    const path = getFirebaseDataPath(currentSupabaseUserId);
    try {
        const snapshot = await database.ref(path).once('value');
        const firebaseData = snapshot.val();
        if (firebaseData) {
            console.log("Firebase data loaded:", firebaseData);
            // P≈ôep√≠≈°eme lok√°ln√≠ data daty z Firebase
            galleryImagesData = firebaseData.galleryImages || [...initialImageUrls];
            savedCodesData = firebaseData.savedCodes || [];
            externalLinksData = firebaseData.externalLinks || [...initialExternalLinksData];
            editableContentData = firebaseData.editableContent || {};
            
            // Aplikujeme naƒçten√Ω obsah na str√°nku
            applyEditableContent();
            updateGalleryDisplay();
            renderSavedCodesDisplay();
            renderExternalLinks();
            
            // --- TENTO ≈ò√ÅDEK BYL ZAKOMENTOV√ÅN/ODSTRANƒöN PRO TICHO ---
            // showAlertModal("Data synchronizov√°na", "Data byla √∫spƒõ≈°nƒõ naƒçtena z cloudu."); 
        } else {
            console.log("No data found in Firebase for this user. Loading from localStorage or initial data.");
            // Pokud na Firebase nejsou data, nahrajeme tam ty z localStorage / defaultn√≠
            await saveDataToFirebase();
        }
    } catch (error) {
        console.error("Error loading data from Firebase:", error);
        showAlertModal("Chyba synchronizace", `Nepoda≈ôilo se naƒç√≠st data z cloudu: ${error.message}`);
        // Fallback: Pokud se nepoda≈ô√≠ naƒç√≠st z Firebase, pokus√≠me se naƒç√≠st z localStorage
        loadDataFromLocalStorage();
    } finally {
        hideLoading();
    }
}

// Funkce pro ukl√°d√°n√≠ dat na Firebase
async function saveDataToFirebase() {
    if (!currentSupabaseUserId) {
        console.warn("User not logged in, skipping Firebase data save.");
        return false;
    }
    showLoading("Ukl√°d√°m data do vesm√≠ru...");
    const path = getFirebaseDataPath(currentSupabaseUserId);
    const dataToSave = {
        galleryImages: galleryImagesData,
        savedCodes: savedCodesData,
        externalLinks: externalLinksData,
        editableContent: editableContentData
    };
    try {
        await database.ref(path).set(dataToSave);
        console.log("Data successfully saved to Firebase.");
        hideLoading();
        return true;
    } catch (error) {
        console.error("Error saving data to Firebase:", error);
        showAlertModal("Chyba ukl√°d√°n√≠", `Nepoda≈ôilo se ulo≈æit data do cloudu: ${error.message}`);
        hideLoading();
        return false;
    }
}

// --- Supabase autentizace a p≈ôesmƒõrov√°n√≠ ---
// Ponech√°v√°me Supabase Auth jako prim√°rn√≠ p≈ôihla≈°ovac√≠ syst√©m.
// Po p≈ôihl√°≈°en√≠ Supabase u≈æivatele z√≠sk√°me jeho ID pro Firebase.
document.addEventListener('DOMContentLoaded', function() {
    const loadingIndicatorElement = document.getElementById('loading-indicator');

    if (loadingIndicatorElement) {
        loadingIndicatorElement.textContent = "Naƒç√≠t√°n√≠ str√°nky...";
        loadingIndicatorElement.classList.remove('hidden');
    } else {
        console.error("Loading indicator element not found!");
    }
    
    // Kontrola Supabase knihovny (z≈Øst√°v√° stejn√°)
    if (typeof supabase === 'undefined' || typeof supabase.createClient !== 'function') {
        console.error('Supabase library not loaded or createClient is not a function.');
        if (loadingIndicatorElement) {
            loadingIndicatorElement.textContent = 'Kritick√° chyba: Knihovna Supabase se nenaƒçetla.';
        }
        document.body.style.visibility = 'visible';
        return;
    }
    
    // Kontrola Firebase knihovny
    if (typeof firebase === 'undefined' || typeof firebase.initializeApp !== 'function') {
        console.error('Firebase library not loaded or initializeApp is not a function. Check your HTML script tags.');
        if (loadingIndicatorElement) {
            loadingIndicatorElement.textContent = 'Kritick√° chyba: Knihovna Firebase se nenaƒçetla.';
        }
        document.body.style.visibility = 'visible';
        return;
    }

    // --- Supabase autentizace a p≈ôesmƒõrov√°n√≠ ---
    supabaseClient.auth.onAuthStateChange(async (event, session) => {
        console.log('Supabase Auth State Change:', event, session);
        if (event === 'SIGNED_OUT') {
            currentSupabaseUserId = null; // Vyma≈æeme ID u≈æivatele
            disableEditMode();
            localStorage.removeItem(EDIT_MODE_KEY);
            if (window.location.pathname !== '/login.html' && window.location.pathname !== '/signup.html') {
                console.log('U≈æivatel odhl√°≈°en, editaƒçn√≠ re≈æim vypnut.');
                document.getElementById('login-button')?.classList.remove('hidden');
                document.getElementById('edit-mode-toggle-btn')?.classList.add('hidden');
                document.getElementById('user-id-display')?.classList.add('hidden');
            }
            initializeApp(true); // Inicializujeme aplikaci bez p≈ôihl√°≈°en√©ho u≈æivatele (naƒçte jen z localStorage)
        } else if (event === 'SIGNED_IN') {
            console.log('U≈æivatel je p≈ôihl√°≈°en.');
            currentSupabaseUserId = session.user.id; // Ulo≈æ√≠me ID p≈ôihl√°≈°en√©ho u≈æivatele
            document.getElementById('login-button')?.classList.add('hidden');
            document.getElementById('edit-mode-toggle-btn')?.classList.remove('hidden');
            
            const userIdDisplaySpan = document.getElementById('firebase-user-id');
            const userIdContainer = document.getElementById('user-id-display');
            if (session && session.user && userIdDisplaySpan && userIdContainer) {
                userIdDisplaySpan.textContent = session.user.id;
                userIdContainer.classList.remove('hidden');
            }
            
            initializeApp(false); // Inicializujeme aplikaci, proto≈æe u≈æivatel je p≈ôihl√°≈°en
            // Po inicializaci aplikace (kter√° naƒçte data z Firebase) zkontrolujeme stav edit m√≥du
            if (localStorage.getItem(EDIT_MODE_KEY) === 'true') {
                enableEditMode();
                document.getElementById('edit-mode-toggle-btn').textContent = 'Zav≈ô√≠t';
            } else {
                disableEditMode();
                document.getElementById('edit-mode-toggle-btn').textContent = 'Upravit';
            }
            
            if (loadingIndicatorElement) loadingIndicatorElement.classList.add('hidden');
            document.body.style.visibility = 'visible';
        }
    });

    // Kontrola stavu p≈ôihl√°≈°en√≠ p≈ôi naƒçten√≠ str√°nky
    async function checkInitialAuthState() {
        const { data: { session }, error } = await supabaseClient.auth.getSession();
        if (error) {
            console.error("Chyba p≈ôi z√≠sk√°v√°n√≠ session:", error);
            if (loadingIndicatorElement) {
                loadingIndicatorElement.textContent = `Chyba ovƒõ≈ôen√≠: ${error.message}. Zkuste obnovit.`;
            }
            document.body.style.visibility = 'visible';
            return;
        }

        if (session) {
            console.log('U≈æivatel je ji≈æ p≈ôihl√°≈°en:', session.user.email);
            currentSupabaseUserId = session.user.id; // Z√≠sk√°me ID u≈æivatele
            document.getElementById('login-button')?.classList.add('hidden');
            document.getElementById('edit-mode-toggle-btn')?.classList.remove('hidden');
            
            const userIdDisplaySpan = document.getElementById('firebase-user-id');
            const userIdContainer = document.getElementById('user-id-display');
            if (session.user && userIdDisplaySpan && userIdContainer) {
                userIdDisplaySpan.textContent = session.user.id;
                userIdContainer.classList.remove('hidden');
            }
            
            if (localStorage.getItem(EDIT_MODE_KEY) === 'true') {
                enableEditMode();
                document.getElementById('edit-mode-toggle-btn').textContent = 'Zav≈ô√≠t';
            } else {
                disableEditMode();
                document.getElementById('edit-mode-toggle-btn').textContent = 'Upravit';
            }
            
            initializeApp(false); // Inicializujeme aplikaci, proto≈æe u≈æivatel je p≈ôihl√°≈°en
            if (loadingIndicatorElement) loadingIndicatorElement.classList.add('hidden');
            document.body.style.visibility = 'visible';
        } else {
            console.log('U≈æivatel nen√≠ p≈ôihl√°≈°en.');
            currentSupabaseUserId = null; // Vyma≈æeme ID u≈æivatele
            initializeApp(true); // Inicializujeme appku bez p≈ôihl√°≈°en√©ho u≈æivatele
            if (loadingIndicatorElement) loadingIndicatorElement.classList.add('hidden');
            document.body.style.visibility = 'visible';
            document.getElementById('login-button')?.classList.remove('hidden');
            document.getElementById('edit-mode-toggle-btn')?.classList.add('hidden');
            document.getElementById('user-id-display')?.classList.add('hidden');
            disableEditMode();
            localStorage.removeItem(EDIT_MODE_KEY);
        }
    }
    checkInitialAuthState();
});

// --- Funkce pro zobrazen√≠/skryt√≠ p≈ôihla≈°ovac√≠ho modalu (z≈Øst√°vaj√≠ stejn√©) ---
function showAuthModal() {
    showModal(document.getElementById('auth-modal'));
    document.getElementById('auth-email').focus();
    document.getElementById('auth-error-message').textContent = '';
}

function hideAuthModal() {
    hideModal(document.getElementById('auth-modal'));
    document.getElementById('auth-email').value = '';
    document.getElementById('auth-password').value = '';
    document.getElementById('auth-error-message').textContent = '';
}

document.getElementById('cancel-auth-btn')?.addEventListener('click', hideAuthModal);

// --- Funkce pro p≈ôihl√°≈°en√≠ (integrujeme s Firebase) ---
document.getElementById('login-auth-btn')?.addEventListener('click', async () => {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    const errorMessageEl = document.getElementById('auth-error-message');
    errorMessageEl.textContent = '';

    showLoading("P≈ôihla≈°ov√°n√≠...");

    const { error, session } = await supabaseClient.auth.signInWithPassword({ email, password });
    if (error) {
        console.error('Chyba p≈ôi p≈ôihla≈°ov√°n√≠:', error.message);
        errorMessageEl.textContent = `Chyba: ${error.message}`;
        hideLoading();
    } else {
        hideAuthModal();
        // currentSupabaseUserId je nastaven v onAuthStateChange listeneru
        // initializeApp je tak√© vol√°n v onAuthStateChange listeneru
        // enableEditMode je vol√°n v onAuthStateChange listeneru po naƒçten√≠ dat
        hideLoading();
    }
});

// --- Funkce pro registraci (integrujeme s Firebase) ---
document.getElementById('signup-auth-btn')?.addEventListener('click', async () => {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    const errorMessageEl = document.getElementById('auth-error-message');
    errorMessageEl.textContent = '';

    showLoading("Registrace...");

    const { data, error } = await supabaseClient.auth.signUp({ email, password });
    if (error) {
        console.error('Chyba p≈ôi registraci:', error.message);
        errorMessageEl.textContent = `Chyba: ${error.message}`;
        hideLoading();
    } else {
        if (data && data.user) {
            // Po √∫spƒõ≈°n√© registraci (a ovƒõ≈ôen√≠ e-mailu, pokud je vy≈æadov√°no)
            // U≈æivatel bude automaticky p≈ôihl√°≈°en, a onAuthStateChange to zachyt√≠
            // a inicializuje appku a naƒçte data z Firebase.
            showAlertModal("Registrace √∫spƒõ≈°n√°", "Registrace probƒõhla √∫spƒõ≈°nƒõ! Nyn√≠ se m≈Ø≈æete p≈ôihl√°sit.");
        } else {
            showAlertModal("Registrace vy≈æaduje potvrzen√≠", "Zkontrolujte sv≈Øj email pro potvrzen√≠ registrace. Pot√© se m≈Ø≈æete p≈ôihl√°sit.");
        }
        hideAuthModal();
        hideLoading();
    }
});

// --- Funkce pro odhl√°≈°en√≠ (z≈Øst√°v√° stejn√°, Firebase ID se sma≈æe v onAuthStateChange) ---
window.signOut = async function() {
    const confirmed = await (window.showConfirmModal ?
        showConfirmModal("Odhl√°sit se?", "Opravdu se chcete odhl√°sit?", { okText: 'Ano, odhl√°sit', cancelText: 'Z≈Østat p≈ôihl√°≈°en' }) :
        confirm("Opravdu se chcete odhl√°sit?")
    );

    if (confirmed) {
        showLoading("Odhla≈°ov√°n√≠...");
        const { error } = await supabaseClient.auth.signOut();
        if (error) {
            console.error('Chyba p≈ôi odhla≈°ov√°n√≠:', error.message);
            showAlertModal("Chyba odhl√°≈°en√≠", `Nepoda≈ôilo se odhl√°sit: ${error.message}`);
            hideLoading();
        } else {
            showAlertModal("Odhl√°≈°en√≠", "Byli jste √∫spƒõ≈°nƒõ odhl√°≈°eni. Pro √∫pravy se opƒõt p≈ôihlaste.");
            // currentSupabaseUserId je nastaven na null v onAuthStateChange listeneru
            // disableEditMode je vol√°n v onAuthStateChange listeneru
            hideLoading();
        }
    }
};

// --- Glob√°ln√≠ promƒõnn√© a pomocn√© funkce ---
let activeSection = 'about';
let galleryImagesData = [];
let savedCodesData = [];
let externalLinksData = [];
let currentModalImageIndex = 0;
let editableContentData = {}; // Nov√Ω objekt pro ukl√°d√°n√≠ editovateln√©ho obsahu

const STORAGE_KEYS = {
    GALLERY_IMAGES: 'portfolio_gallery_images',
    SAVED_CODES: 'portfolio_saved_codes',
    EXTERNAL_LINKS: 'portfolio_external_links',
    EDITABLE_CONTENT: 'portfolio_editable_content' // Nov√Ω kl√≠ƒç pro editovateln√Ω obsah
};

const initialImageUrls = [
    { id: 'initial-1', url: 'https://img.freepik.com/free-photo/futuristic-background-with-colorful-abstract-design_1340-39 futuristic-technology-background-with-neon-lights_76964-11458.jpg?w=826&t=st=1716545000~exp=1716545600~hmac=e6108f60104301f3b2886131029b0f10151707f3020142e9950b1e22704c654a', name: 'Technologie'},
    { id: 'initial-2', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_4k18.jpg?ver=0', name: 'Srdce'},
    { id: 'initial-3', url: 'https://img.freepik.com/free-photo/glowing-spaceship-orbits-planet-starry-galaxy-generated-by-ai_188544-9655.jpg?w=1060&t=st=1716545052~exp=1716545652~hmac=c6a7d107b56da6822f221372f4476a3793075997b820160f494a887688068b14', name: 'Vesm√≠rn√° loƒè'},
    { id: 'initial-4', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_4k7.jpg?ver=0', name: 'Mlhovina'},
    { id: 'initial-5', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_4k8.jpg?ver=0', name: 'Kyberpunk mƒõsto'},
    { id: 'initial-6', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_4k13.jpg?ver=0', name: 'Notebook v akci'},
    { id: 'initial-7', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_4k14.jpg?ver=0', name: 'Galaxie'},
    { id: 'initial-8', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_1920x10804.jpg?ver=0', name: 'Lidsk√Ω mozek'},
    { id: 'initial-9', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_15360x86402.jpg?ver=0', name: 'Vƒõdeck√© laborato≈ôe'},
    { id: 'initial-10', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/misurina-sunset.jpg?ver=0', name: 'Neuronov√° s√≠≈•'},
    { id: 'initial-11', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/snowy-landscape-with-mountains-lake-with-snow-ground.jpg?ver=0', name: 'Datov√° m≈ô√≠≈æka'},
    { id: 'initial-12', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/wet-sphere-reflective-water-abstract-beauty-generated-by-ai.jpg?ver=0', name: 'Futuristick√© mƒõsto'},
    { id: 'initial-13', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/vnon-pozadi-od-admirala-chatbota..jpg?ver=0', name: 'Svƒõteln√° geometrie'},
    { id: 'initial-14', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_1024x1792.jpg?ver=0', name: 'Digit√°ln√≠ plameny'},
    { id: 'initial-15', url: 'https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_300x3001_2.jpg?ver=0', name: 'Exoplaneta'},
    { id: 'initial-16', url: 'https://img36.rajce.idnes.cz/d3603/10/10185/10185286_0147349ad505c43a2d9f6eb372624417/images/CIMG0039.jpg?ver=3', name: 'Kybernetick√° maska'},
];

let initialExternalLinksData = [
    { title: 'Claude AI', url: 'https://claude.ai/' }, { title: 'SledujSerialy', url: 'https://sledujserialy.sx/' },
    { title: 'Kukaj.me', url: 'https://serial.kukaj.me/' }, { title: 'ProSebe.cz', url: 'https://prosebe.cz/user/project' },
    { title: 'Populace.cz', url: 'https://www.populace.cz' }, { title: 'My-Map.eu', url: 'https://www.my-map.eu/odmeny' },
    { title: 'N√°rodn√≠ Panel', url: 'https://www.narodnipanel.cz/?backlink=expx2' }, { title: 'Lifepoints Panel', url: 'https://app.lifepointspanel.com/en-US/login' },
    { title: 'Voyo', url: 'https://voyo.nova.cz/' }, { title: 'P≈ôehraj.to', url: 'https://prehrajto.cz/' },
    { title: 'SledovaniTV.cz', url: 'https://sledovanitv.cz/' }, { title: 'Bombuj', url: 'https://www.bombuj.si/' },
];

// --- Funkce pro ukl√°d√°n√≠ a naƒç√≠t√°n√≠ z localStorage (s upravenou logikou pro editableContent) ---
// Tyto funkce nyn√≠ budou vol√°ny prim√°rnƒõ pro pr√°ci s lok√°ln√≠ cache, zat√≠mco saveAllData/loadDataFromStorage
// budou vol√°ny pro inicializaci a koneƒçn√© ulo≈æen√≠ na Firebase.
function saveToLocalStorage(key, data) {
    try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
    } catch (error) {
        console.error('Chyba p≈ôi ukl√°d√°n√≠ do localStorage:', error);
        if (window.showAlertModal) showAlertModal("Chyba ukl√°d√°n√≠", "Nepoda≈ôilo se ulo≈æit data do trval√©ho √∫lo≈æi≈°tƒõ. Mo≈æn√° je √∫lo≈æi≈°tƒõ pln√©.");
        else alert("Chyba ukl√°d√°n√≠ do localStorage.");
        return false;
    }
}

function loadFromLocalStorage(key, defaultValue = []) {
    try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
    } catch (error) {
        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ z localStorage:', error);
        return defaultValue;
    }
}

function clearLocalStorageData() {
    try {
        Object.values(STORAGE_KEYS).forEach(key => {
            localStorage.removeItem(key);
        });
        localStorage.removeItem(EDIT_MODE_KEY);

        if (window.showAlertModal) showAlertModal("Data vymaz√°na", "V≈°echna ulo≈æen√° data byla √∫spƒõ≈°nƒõ vymaz√°na z trval√©ho √∫lo≈æi≈°tƒõ.");
        else alert("Data vymaz√°na.");
        
        // Po vymaz√°n√≠ se vr√°t√≠me k v√Ωchoz√≠m dat≈Øm a obnov√≠me zobrazen√≠
        galleryImagesData = [...initialImageUrls];
        savedCodesData = [];
        externalLinksData = [...initialExternalLinksData];
        editableContentData = {};
        applyEditableContent();

        updateGalleryDisplay();
        renderSavedCodesDisplay();
        renderExternalLinks();
        showAlertModal("Data vymaz√°na", "V≈°echna data vƒçetnƒõ upraven√©ho textu byla vymaz√°na a str√°nka se vr√°tila k v√Ωchoz√≠mu obsahu.");
        
        // Tak√© sma≈æeme data z Firebase pro aktu√°ln√≠ho u≈æivatele (pokud je p≈ôihl√°≈°en)
        if (currentSupabaseUserId) {
            database.ref(getFirebaseDataPath(currentSupabaseUserId)).remove()
                .then(() => console.log("Firebase data for user also cleared."))
                .catch(error => console.error("Error clearing Firebase data:", error));
        }

        return true;
    } catch (error) {
        console.error('Chyba p≈ôi maz√°n√≠ localStorage dat:', error);
        if (window.showAlertModal) showAlertModal("Chyba", "Nepoda≈ôilo se vymazat v≈°echna data.");
        else alert("Chyba p≈ôi maz√°n√≠ dat.");
        return false;
    }
}

// Upraven√° funkce loadDataFromStorage: Nyn√≠ naƒç√≠t√° i z Firebase, pokud je u≈æivatel p≈ôihl√°≈°en
function loadDataFromStorage() {
    // 1. V≈ædy naƒçti lok√°ln√≠ data (pro okam≈æit√© zobrazen√≠ / offline fallback)
    const savedImages = loadFromLocalStorage(STORAGE_KEYS.GALLERY_IMAGES, []);
    galleryImagesData = savedImages.length > 0 ? savedImages : [...initialImageUrls];
    
    savedCodesData = loadFromLocalStorage(STORAGE_KEYS.SAVED_CODES, []);
    
    const savedLinks = loadFromLocalStorage(STORAGE_KEYS.EXTERNAL_LINKS, []);
    externalLinksData = savedLinks.length > 0 ? savedLinks : [...initialExternalLinksData];

    editableContentData = loadFromLocalStorage(STORAGE_KEYS.EDITABLE_CONTENT, {});
    applyEditableContent();

    // 2. Pokud je u≈æivatel p≈ôihl√°≈°en, zkus naƒç√≠st/synchronizovat z Firebase
    if (currentSupabaseUserId) {
        loadDataFromFirebase();
    }
}

// --- Funkce pro aplikaci editovateln√©ho obsahu (z≈Øst√°v√° stejn√°) ---
function applyEditableContent() {
    for (const id in editableContentData) {
        const element = document.querySelector(`[data-editable="${id}"]`);
        if (element) {
            if (element.tagName === 'A' && element.classList.contains('editable-link')) {
                element.href = editableContentData[id].url || '#';
                element.innerHTML = `${editableContentData[id].text || ''}<i class="fas fa-edit edit-icon ${isEditMode ? '' : 'hidden'}"></i>`;
            } else {
                element.innerHTML = editableContentData[id];
            }
        }
    }

    const portfolioItems = document.querySelectorAll('.portfolio-item');
    portfolioItems.forEach(item => {
        const itemId = item.dataset.itemId;
        if (editableContentData[`${itemId}-title`]) {
            item.querySelector(`[data-editable="${itemId}-title"]`).innerHTML = editableContentData[`${itemId}-title`];
        }
        if (editableContentData[`${itemId}-desc-1`]) {
            item.querySelector(`[data-editable="${itemId}-desc-1"]`).innerHTML = editableContentData[`${itemId}-desc-1`];
        }
        const desc2Element = item.querySelector(`[data-editable="${itemId}-desc-2"]`);
        if (desc2Element && editableContentData[`${itemId}-desc-2`]) {
            desc2Element.innerHTML = editableContentData[`${itemId}-desc-2`];
        }

        const linkElement = item.querySelector(`[data-link-id="${itemId}-link"]`);
        if (linkElement && editableContentData[`${itemId}-link-url`]) {
            linkElement.href = editableContentData[`${itemId}-link-url`];
            linkElement.innerHTML = `${editableContentData[`${itemId}-link-text`]}<i class="fas fa-edit edit-icon ${isEditMode ? '' : 'hidden'}"></i>`;
        }
    });
}

// initializeApp nyn√≠ p≈ôij√≠m√° parametr, zda se m√° naƒç√≠st z Firebase
function initializeApp(loadOnlyLocalStorage = false) {
    setupNavigation();
    setupHtmlEditor();
    setupGallery();
    setupDataManagement();
    
    // Pokud je u≈æivatel p≈ôihl√°≈°en, loadDataFromStorage to vezme v potaz a zkus√≠ Firebase
    // Pokud loadOnlyLocalStorage je true (u≈æivatel nen√≠ p≈ôihl√°≈°en), naƒçteme jen z localStorage
    if (loadOnlyLocalStorage) {
        const savedImages = loadFromLocalStorage(STORAGE_KEYS.GALLERY_IMAGES, []);
        galleryImagesData = savedImages.length > 0 ? savedImages : [...initialImageUrls];
        savedCodesData = loadFromLocalStorage(STORAGE_KEYS.SAVED_CODES, []);
        const savedLinks = loadFromLocalStorage(STORAGE_KEYS.EXTERNAL_LINKS, []);
        externalLinksData = savedLinks.length > 0 ? savedLinks : [...initialExternalLinksData];
        editableContentData = loadFromLocalStorage(STORAGE_KEYS.EDITABLE_CONTENT, {});
        applyEditableContent(); // Aplikovat naƒçten√Ω obsah na str√°nku
    } else {
        loadDataFromStorage(); // Tato funkce ji≈æ vol√° Firebase, pokud je u≈æivatel p≈ôihl√°≈°en
    }

    renderExternalLinks();
    updateGalleryDisplay();
    renderSavedCodesDisplay();

    const currentYearEl = document.getElementById('currentYear');
    if (currentYearEl) currentYearEl.textContent = new Date().getFullYear();

    showSection(activeSection, true);
    console.log("Aplikace inicializov√°na.");
}

// --- Funkce pro p≈ôep√≠n√°n√≠ editaƒçn√≠ho m√≥du (z≈Øst√°vaj√≠ stejn√©) ---
function toggleEditMode() {
    if (isEditMode) {
        disableEditMode();
        showAlertModal("Editace ukonƒçena", "Re≈æim √∫prav byl vypnut. Va≈°e zmƒõny byly ulo≈æeny do mezipamƒõti prohl√≠≈æeƒçe. Pro trval√© ulo≈æen√≠ kliknƒõte na 'Ulo≈æit v≈°e'.");
    } else {
        enableEditMode();
        showAlertModal("Re≈æim √∫prav", "Jste v re≈æimu √∫prav. Kliknƒõte na text pro √∫pravu, nebo pou≈æijte ikony pro obr√°zky/odkazy. Nezapome≈àte ulo≈æit zmƒõny!");
    }
}

function enableEditMode() {
    isEditMode = true;
    document.body.classList.add('edit-mode');
    document.getElementById('login-button')?.classList.add('hidden');
    document.getElementById('edit-mode-toggle-btn').textContent = 'Zav≈ô√≠t';
    document.getElementById('edit-mode-toggle-btn')?.classList.remove('hidden');

    document.querySelectorAll('[data-editable]').forEach(el => {
        el.setAttribute('contenteditable', 'true');
    });

    document.querySelectorAll('.editable-image-wrapper .edit-icon').forEach(icon => {
        icon.classList.remove('hidden');
    });
    document.querySelectorAll('.editable-link .edit-icon').forEach(icon => {
        icon.classList.remove('hidden');
    });

    document.querySelectorAll('.portfolio-item .edit-controls').forEach(controls => {
        controls.classList.remove('hidden');
    });
    document.getElementById('add-portfolio-item-btn').classList.remove('hidden');
    document.getElementById('add-link-btn').classList.remove('hidden');
    document.getElementById('data-management').classList.remove('hidden');

    document.querySelectorAll('#links-table .edit-mode-only').forEach(el => {
        el.style.display = 'table-cell';
    });

    localStorage.setItem(EDIT_MODE_KEY, 'true');
}

function disableEditMode() {
    isEditMode = false;
    document.body.classList.remove('edit-mode');
    document.getElementById('edit-mode-toggle-btn').textContent = 'Upravit';
    supabaseClient.auth.getSession().then(({ data: { session } }) => {
        if (!session) {
            document.getElementById('login-button')?.classList.remove('hidden');
            document.getElementById('edit-mode-toggle-btn')?.classList.add('hidden');
        }
    });

    document.querySelectorAll('[contenteditable="true"]').forEach(el => {
        el.removeAttribute('contenteditable');
        const id = el.dataset.editable;
        if (id) {
            if (el.tagName === 'A' && el.classList.contains('editable-link')) {
                editableContentData[id] = { url: el.href, text: el.childNodes[0] ? el.childNodes[0].nodeValue.trim() : '' };
            } else {
                editableContentData[id] = el.innerHTML;
            }
        }
    });

    document.querySelectorAll('.editable-image-wrapper .edit-icon').forEach(icon => {
        icon.classList.add('hidden');
    });
    document.querySelectorAll('.editable-link .edit-icon').forEach(icon => {
        icon.classList.add('hidden');
    });

    document.querySelectorAll('.portfolio-item .edit-controls').forEach(controls => {
        controls.classList.add('hidden');
    });
    document.getElementById('add-portfolio-item-btn').classList.add('hidden');
    document.getElementById('add-link-btn').classList.add('hidden');
    document.getElementById('data-management').classList.add('hidden');

    document.querySelectorAll('#links-table .edit-mode-only').forEach(el => {
        el.style.display = 'none';
    });

    saveToLocalStorage(STORAGE_KEYS.EDITABLE_CONTENT, editableContentData);
    localStorage.removeItem(EDIT_MODE_KEY);
}

// --- Funkce pro naƒç√≠t√°n√≠ a skr√Ωv√°n√≠ indik√°toru (z≈Øst√°vaj√≠ stejn√©) ---
function showLoading(message = "Naƒç√≠t√°n√≠...") {
    const loadingIndicatorElement = document.getElementById('loading-indicator');
    if (loadingIndicatorElement) {
        loadingIndicatorElement.textContent = message;
        loadingIndicatorElement.classList.remove('hidden');
    }
}
function hideLoading() {
    const loadingIndicatorElement = document.getElementById('loading-indicator');
    if (loadingIndicatorElement) {
        loadingIndicatorElement.classList.add('hidden');
    }
}

// --- Funkcionalita tlaƒç√≠tek spr√°vy dat (jen JavaScript logika) ---
 function setupDataManagement() {
    // P≈ôipojen√≠ event listener≈Ø k tlaƒç√≠tk≈Øm s dan√Ωmi ID
    document.getElementById('save-all-data-btn')?.addEventListener('click', saveAllDataToStorage);
    document.getElementById('clear-all-data-btn')?.addEventListener('click', handleClearAllData);
    document.getElementById('export-data-btn')?.addEventListener('click', exportData);
    document.getElementById('import-data-btn')?.addEventListener('click', () => {
        document.getElementById('import-file-input')?.click();
    });
    document.getElementById('import-file-input')?.addEventListener('change', handleImportData);
}
// saveAllDataToStorage nyn√≠ vol√° i saveDataToFirebase
function saveAllDataToStorage() {
    document.querySelectorAll('[data-editable]').forEach(el => {
        const id = el.dataset.editable;
        if (id) {
            if (el.tagName === 'A' && el.classList.contains('editable-link')) {
                editableContentData[id] = { url: el.href, text: el.childNodes[0] ? el.childNodes[0].nodeValue.trim() : '' };
            } else {
                editableContentData[id] = el.innerHTML;
            }
        }
    });

    let savedCount = 0;
    if (saveToLocalStorage(STORAGE_KEYS.GALLERY_IMAGES, galleryImagesData)) savedCount++;
    if (saveToLocalStorage(STORAGE_KEYS.SAVED_CODES, savedCodesData)) savedCount++;
    if (saveToLocalStorage(STORAGE_KEYS.EXTERNAL_LINKS, externalLinksData)) savedCount++;
    if (saveToLocalStorage(STORAGE_KEYS.EDITABLE_CONTENT, editableContentData)) savedCount++;
    
    const message = savedCount === 4 ? "V≈°echna data byla √∫spƒõ≈°nƒõ ulo≈æena." : `Ulo≈æeno ${savedCount} ze 4 kategori√≠ dat.`;
    
    // Ulo≈æ√≠me i na Firebase, pokud je u≈æivatel p≈ôihl√°≈°en
    if (currentSupabaseUserId) {
        saveDataToFirebase().then(success => {
            if (success) {
                showAlertModal("Data ulo≈æena", `${message} A tak√© synchronizov√°na s cloudem.`);
            } else {
                showAlertModal("Ulo≈æeno lok√°lnƒõ", `${message} Ale nepoda≈ôilo se synchronizovat s cloudem.`);
            }
        });
    } else {
        showAlertModal(savedCount === 4 ? "Data ulo≈æena" : "ƒå√°steƒçn√© ulo≈æen√≠", `${message} Pro synchronizaci se p≈ôihlaste.`);
    }
}

// handleClearAllData nyn√≠ vol√° i clearLocalStorageData, kter√° ma≈æe i z Firebase
async function handleClearAllData() {
    const confirmed = await (window.showConfirmModal ?
        showConfirmModal("Vymazat v≈°echna data?", "Opravdu chcete vymazat v≈°echna ulo≈æen√° data? Tato akce je nevratn√°! Zahrnuje i texty upraven√© na str√°nce a data v cloudu.", { okText: 'Ano, vymazat', cancelText: 'Zru≈°it' }) :
        confirm("Opravdu chcete vymazat v≈°echna ulo≈æen√° data?")
    );
    
    if (confirmed) {
        clearLocalStorageData();
    }
}

// exportData a importData se nemƒõn√≠, proto≈æe pracuj√≠ s lok√°ln√≠m JSONem
function exportData() {
    document.querySelectorAll('[data-editable]').forEach(el => {
        const id = el.dataset.editable;
        if (id) {
            if (el.tagName === 'A' && el.classList.contains('editable-link')) {
                editableContentData[id] = { url: el.href, text: el.childNodes[0] ? el.childNodes[0].nodeValue.trim() : '' };
            } else {
                editableContentData[id] = el.innerHTML;
            }
        }
    });

    const exportObject = {
        galleryImages: galleryImagesData,
        savedCodes: savedCodesData,
        externalLinks: externalLinksData,
        editableContent: editableContentData,
        exportDate: new Date().toISOString(),
        version: "1.1"
    };
    
    const dataStr = JSON.stringify(exportObject, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `portfolio-data-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    
    if(window.showAlertModal) showAlertModal("Export dokonƒçen", "Data byla exportov√°na do souboru JSON.");
    else alert("Data exportov√°na.");
}

function handleImportData(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = async function(e) {
        try {
            const importedData = JSON.parse(e.target.result);
            const confirmed = await (window.showConfirmModal ?
                showConfirmModal("Importovat data?", "Importov√°n√≠ p≈ôep√≠≈°e v≈°echna souƒçasn√° data (vƒçetnƒõ text≈Ø na str√°nce). Chcete pokraƒçovat?", { okText: 'Ano, importovat', cancelText: 'Zru≈°it' }) :
                confirm("Importov√°n√≠ p≈ôep√≠≈°e data. Pokraƒçovat?")
            );
            
            if (confirmed) {
                if (importedData.galleryImages) galleryImagesData = importedData.galleryImages;
                if (importedData.savedCodes) savedCodesData = importedData.savedCodes;
                if (importedData.externalLinks) externalLinksData = importedData.externalLinks;
                if (importedData.editableContent) editableContentData = importedData.editableContent;
                
                saveAllDataToStorage(); // Ulo≈æ√≠ naimportovan√° data lok√°lnƒõ i na Firebase
                
                applyEditableContent();
                updateGalleryDisplay();
                renderSavedCodesDisplay();
                renderExternalLinks();
                
                if(window.showAlertModal) showAlertModal("Import dokonƒçen", "Data byla √∫spƒõ≈°nƒõ naimportov√°na a ulo≈æena.");
                else alert("Data naimportov√°na.");
            }
        } catch (error) {
            console.error('Chyba p≈ôi importu:', error);
            if(window.showAlertModal) showAlertModal("Chyba importu", "Nepoda≈ôilo se naƒç√≠st data ze souboru. Zkontrolujte, zda je soubor platn√Ω JSON.");
            else alert("Chyba importu dat.");
        }
    };
    reader.readAsText(file);
    event.target.value = '';
}

// --- Navigace a sekce (z≈Øst√°vaj√≠ stejn√©) ---
function setupNavigation() {
    const navLinks = document.querySelectorAll('.nav-container a.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const sectionId = link.dataset.section;
            showSection(sectionId);
            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
        });
    });
    const initialActiveLink = document.querySelector(`.nav-container a.nav-link[data-section="${activeSection}"]`);
    if (initialActiveLink) initialActiveLink.classList.add('active');
}

function showSection(id, isInitial = false) {
    if (!id) id = 'about';
    activeSection = id;
    document.querySelectorAll('main section').forEach(section => {
        section.classList.remove('active');
        if (!(isInitial && section.id === id)) {
            section.style.display = 'none';
        }
    });
    const sectionElement = document.getElementById(id);
    if (sectionElement) {
        sectionElement.style.display = 'block';
        setTimeout(() => sectionElement.classList.add('active'), 10);
    } else {
        console.warn(`Sekce s ID "${id}" nebyla nalezena. Zobrazuji 'about'.`);
        const aboutSection = document.getElementById('about');
        if(aboutSection) {
            aboutSection.style.display = 'block';
            setTimeout(() => aboutSection.classList.add('active'), 10);
            activeSection = 'about';
            document.querySelectorAll('.nav-container a.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector('.nav-container a.nav-link[data-section="about"]')?.classList.add('active');
        }
    }
}

// --- HTML Editor (upravujeme pro Firebase) ---
function setupHtmlEditor() {
    const editor = document.getElementById('html-editor');
    const preview = document.getElementById('html-preview');
    const saveBtn = document.getElementById('save-code-btn');
    
    if (!editor || !preview || !saveBtn) {
        console.error("HTML editor elementy nebyly nalezeny!");
        return;
    }

    editor.addEventListener('input', () => { preview.srcdoc = editor.value; });
    preview.srcdoc = editor.value;

    saveBtn.addEventListener('click', () => {
        if (!editor.value.trim()) {
            if(window.showAlertModal) showAlertModal("Pr√°zdn√Ω k√≥d", "Nelze ulo≈æit pr√°zdn√Ω HTML k√≥d.");
            else alert("Nelze ulo≈æit pr√°zdn√Ω k√≥d.");
            return;
        }
        const saveModal = document.getElementById('save-code-modal');
        if(saveModal) showModal(saveModal);
        document.getElementById('code-title-input')?.focus();
    });
}

function saveHtmlCodeLocally(title, code) {
    const newCode = {
        id: `local-code-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`,
        title, code, createdAt: new Date().toISOString()
    };
    savedCodesData.unshift(newCode);
    saveToLocalStorage(STORAGE_KEYS.SAVED_CODES, savedCodesData); // Ulo≈æ√≠ lok√°lnƒõ
    // A tak√© na Firebase
    if (currentSupabaseUserId) {
        saveDataToFirebase(); // Ulo≈æ√≠ v≈°echna data, vƒçetnƒõ savedCodesData
    }
    renderSavedCodesDisplay();
    if(window.showAlertModal) showAlertModal("K√≥d ulo≈æen", `K√≥d "${title}" byl trvale ulo≈æen.`);
    else alert(`K√≥d "${title}" ulo≈æen.`);
}

function deleteHtmlCodeLocally(id) {
    savedCodesData = savedCodesData.filter(code => code.id !== id);
    saveToLocalStorage(STORAGE_KEYS.SAVED_CODES, savedCodesData); // Ulo≈æ√≠ lok√°lnƒõ
    // A tak√© na Firebase
    if (currentSupabaseUserId) {
        saveDataToFirebase();
    }
    renderSavedCodesDisplay();
}

function renderSavedCodesDisplay() {
    const listEl = document.getElementById('saved-codes-list');
    if(!listEl) return;
    listEl.innerHTML = savedCodesData.length === 0 ? '<p>≈Ω√°dn√© k√≥dy nejsou aktu√°lnƒõ ulo≈æeny.</p>' : '';
    
    savedCodesData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'saved-code-item';
        div.innerHTML = `
                <div class="item-header">
                    <h3>${item.title}</h3>
                    <div class="actions">
                        <button class="button btn-secondary load-code">Naƒç√≠st</button>
                        <button class="button btn-danger delete-code">Smazat</button>
                    </div>
                </div>
                <p>Ulo≈æeno: ${new Date(item.createdAt).toLocaleString('cs-CZ')}</p>
            `;
        div.querySelector('.load-code').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('html-editor').value = item.code;
            document.getElementById('html-preview').srcdoc = item.code;
            showSection('editor');
            document.querySelector('.nav-container a.nav-link[data-section="editor"]')?.click();
        });
        div.querySelector('.delete-code').addEventListener('click', async (e) => {
            e.stopPropagation();
            const confirmed = await (window.showConfirmModal ?
                showConfirmModal("Smazat k√≥d?", `Opravdu chcete smazat k√≥d "${item.title}"?`) :
                confirm(`Smazat k√≥d "${item.title}"?`)
            );
            if (confirmed) deleteHtmlCodeLocally(item.id);
        });
        div.addEventListener('click', () => {
            document.getElementById('html-editor').value = item.code;
            document.getElementById('html-preview').srcdoc = item.code;
            showSection('editor');
            document.querySelector('.nav-container a.nav-link[data-section="editor"]')?.click();
        });
        listEl.appendChild(div);
    });
}

// --- Galerie (upravujeme pro Firebase) ---
function setupGallery() {
    const addBtn = document.getElementById('addImageUrlBtn');
    const closeBtn = document.getElementById('close-modal-btn');
    const prevBtn = document.getElementById('prev-image-btn');
    const nextBtn = document.getElementById('next-image-btn');
    const saveEditImageBtn = document.getElementById('save-edit-image-btn');
    const cancelEditImageBtn = document.getElementById('cancel-edit-image-btn');
    
    if(addBtn) addBtn.addEventListener('click', handleAddImageUrl);
    if(closeBtn) closeBtn.addEventListener('click', closeImageModal);
    if(prevBtn) prevBtn.addEventListener('click', () => navigateImageModal(-1));
    if(nextBtn) nextBtn.addEventListener('click', () => navigateImageModal(1));
    if(saveEditImageBtn) saveEditImageBtn.addEventListener('click', saveEditedImage);
    if(cancelEditImageBtn) cancelEditImageBtn.addEventListener('click', () => hideModal(document.getElementById('edit-image-modal')));
}

async function handleAddImageUrl() {
    const urlInput = document.getElementById('newImageUrl');
    if (!urlInput) {
        console.error("Element #newImageUrl not found for adding gallery image.");
        return;
    }
    const imageUrl = urlInput.value.trim();

    if (imageUrl && isValidHttpUrl(imageUrl)) {
        const imageNamePrompt = prompt(`Zadejte n√°zev pro obr√°zek (URL: ${imageUrl.substring(0,50)}...). Pr√°zdn√© pro v√Ωchoz√≠ n√°zev.`, `Obr√°zek ${galleryImagesData.length + 1}`);
        let imageName = (imageNamePrompt && imageNamePrompt.trim() !== "") ? imageNamePrompt.trim() : `Obr√°zek ${galleryImagesData.length + 1}_${Math.floor(Math.random()*1000)}`;
        
        const newImage = {
            id: `local-img-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,
            url: imageUrl, name: imageName, createdAt: new Date().toISOString()
        };
        galleryImagesData.unshift(newImage);
        saveToLocalStorage(STORAGE_KEYS.GALLERY_IMAGES, galleryImagesData); // Ulo≈æ√≠ lok√°lnƒõ
        // A tak√© na Firebase
        if (currentSupabaseUserId) {
            saveDataToFirebase();
        }
        updateGalleryDisplay();
        if(window.showAlertModal) showAlertModal("Obr√°zek p≈ôid√°n", `Obr√°zek "${imageName}" byl ulo≈æen.`);
        else alert(`Obr√°zek "${imageName}" ulo≈æen.`);
        urlInput.value = '';
    } else {
        if(window.showAlertModal) showAlertModal("Neplatn√° URL", "Zadejte platnou URL adresu obr√°zku (http:// nebo https://).");
        else alert("Neplatn√° URL.");
    }
}

function isValidHttpUrl(string) {
    let url;
    try { url = new URL(string); }
    catch (_) { return false; }
    return url.protocol === "http:" || url.protocol === "https:";
}

async function deleteGalleryImageLocally(id) {
    const imageToDelete = galleryImagesData.find(img => img.id === id);
    if (!imageToDelete) return;

    const confirmed = await (window.showConfirmModal ?
        showConfirmModal("Smazat obr√°zek?", `Opravdu smazat "${imageToDelete.name || 'tento obr√°zek'}"?`) :
        confirm(`Smazat obr√°zek "${imageToDelete.name || 'tento obr√°zek'}"?`)
    );
    if (confirmed) {
        galleryImagesData = galleryImagesData.filter(img => img.id !== id);
        saveToLocalStorage(STORAGE_KEYS.GALLERY_IMAGES, galleryImagesData); // Ulo≈æ√≠ lok√°lnƒõ
        // A tak√© na Firebase
        if (currentSupabaseUserId) {
            saveDataToFirebase();
        }
        updateGalleryDisplay();
    }
}

function updateGalleryDisplay() {
    const container = document.getElementById('gallery-container');
    if(!container) return;
    container.innerHTML = galleryImagesData.length === 0 ? '<p>Galerie je pr√°zdn√°.</p>' : '';
    
    galleryImagesData.forEach((imgData, index) => {
        const div = document.createElement('div');
        div.className = 'gallery-image-wrapper';
        div.innerHTML = `
                <img src="${imgData.url}" alt="${imgData.name || 'Obr√°zek z galerie'}" onerror="this.onerror=null;this.src='https://placehold.co/250x200/cccccc/ffffff?text=Obr√°zek+nelze+naƒç√≠st';this.alt='Obr√°zek nelze naƒç√≠st';">
                <button class="delete-img-btn ${isEditMode ? '' : 'hidden'}" title="Smazat obr√°zek">&times;</button>
                <i class="fas fa-edit edit-icon ${isEditMode ? '' : 'hidden'}" data-image-id="${imgData.id}"></i>
            `;
        div.querySelector('img').addEventListener('click', () => openImageModal(index));
        div.querySelector('.delete-img-btn')?.addEventListener('click', (e) => {
            e.stopPropagation();
            deleteGalleryImageLocally(imgData.id);
        });
        div.querySelector('.edit-icon')?.addEventListener('click', (e) => {
            e.stopPropagation();
            editImage(imgData.id);
        });
        container.appendChild(div);
    });
}

let editingImageId = null; // Pro ulo≈æen√≠ ID obr√°zku, kter√Ω se pr√°vƒõ edituje
function editImage(imageId) {
    editingImageId = imageId;
    const image = galleryImagesData.find(img => img.id === imageId);
    if (image) {
        document.getElementById('edit-image-url').value = image.url;
        document.getElementById('edit-image-name').value = image.name;
        showModal(document.getElementById('edit-image-modal'));
    }
}

function saveEditedImage() {
    const url = document.getElementById('edit-image-url').value.trim();
    const name = document.getElementById('edit-image-name').value.trim();

    if (!isValidHttpUrl(url)) {
        showAlertModal("Neplatn√° URL", "Zadejte platnou URL adresu obr√°zku (http:// nebo https://).");
        return;
    }

    const index = galleryImagesData.findIndex(img => img.id === editingImageId);
    if (index !== -1) {
        galleryImagesData[index].url = url;
        galleryImagesData[index].name = name;
        saveToLocalStorage(STORAGE_KEYS.GALLERY_IMAGES, galleryImagesData); // Ulo≈æ√≠ lok√°lnƒõ
        // A tak√© na Firebase
        if (currentSupabaseUserId) {
            saveDataToFirebase();
        }
        updateGalleryDisplay();
        hideModal(document.getElementById('edit-image-modal'));
        showAlertModal("Obr√°zek upraven", `Obr√°zek "${name}" byl √∫spƒõ≈°nƒõ upraven.`);
    } else {
        showAlertModal("Chyba", "Obr√°zek k √∫pravƒõ nebyl nalezen.");
    }
}

function openImageModal(index) {
    if (index < 0 || index >= galleryImagesData.length) return;
    currentModalImageIndex = index;
    const modal = document.getElementById('image-modal');
    const modalImg = document.getElementById('modal-img');
    if(!modal || !modalImg) return;

    modalImg.src = galleryImagesData[index].url;
    modalImg.alt = galleryImagesData[index].name || 'Zvƒõt≈°en√Ω obr√°zek';
    showModal(modal);
}

function closeImageModal() {
    hideModal(document.getElementById('image-modal'));
}

function navigateImageModal(direction) {
    const newIndex = currentModalImageIndex + direction;
    if (newIndex >= 0 && newIndex < galleryImagesData.length) {
        openImageModal(newIndex);
    } else if (galleryImagesData.length > 0) {
        currentModalImageIndex = (newIndex < 0) ? galleryImagesData.length - 1 : 0;
        openImageModal(currentModalImageIndex);
    }
}

// --- Extern√≠ odkazy (upravujeme pro Firebase) ---
function renderExternalLinks() {
    const tableBody = document.querySelector('#links-table tbody');
    if (!tableBody) {
        console.error("Table body for links not found!");
        return;
    }
    tableBody.innerHTML = '';
    
    if (externalLinksData.length === 0) {
        const row = tableBody.insertRow();
        const cell = row.insertCell();
        cell.colSpan = 4;
        cell.textContent = '≈Ω√°dn√© extern√≠ odkazy k zobrazen√≠.';
        cell.style.textAlign = 'center';
        return;
    }

    externalLinksData.forEach((link, index) => {
        const div = document.createElement('div'); // This div is not used in the original. It should be a table row.
        const row = tableBody.insertRow(); // Re-inserting the row
        row.insertCell().innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3 -3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`;
        
        const titleCell = row.insertCell();
        const anchor = document.createElement('a');
        anchor.href = link.url;
        anchor.target = "_blank";
        anchor.rel = "noopener noreferrer";
        anchor.textContent = link.title;
        titleCell.appendChild(anchor);
        
        row.insertCell().textContent = link.url;

        const actionsCell = row.insertCell();
        actionsCell.className = 'edit-mode-only';
        actionsCell.innerHTML = `
                <button class="button btn-secondary edit-link-btn" data-index="${index}">Editovat</button>
                <button class="button btn-danger delete-link-btn" data-index="${index}">Smazat</button>
            `;
        actionsCell.querySelector('.edit-link-btn')?.addEventListener('click', () => editLink(index));
        actionsCell.querySelector('.delete-link-btn')?.addEventListener('click', () => deleteLink(index));
    });
}

document.getElementById('add-link-btn')?.addEventListener('click', addLink);

function addLink() {
    editingLinkIndex = -1;
    document.getElementById('edit-link-title').value = '';
    document.getElementById('edit-link-url').value = '';
    showModal(document.getElementById('edit-link-modal'));
}

let editingLinkIndex = null;
function editLink(index) {
    editingLinkIndex = index;
    const link = externalLinksData[index];
    if (link) {
        document.getElementById('edit-link-title').value = link.title;
        document.getElementById('edit-link-url').value = link.url;
        showModal(document.getElementById('edit-link-modal'));
    }
}

function saveEditedLink() {
    const title = document.getElementById('edit-link-title').value.trim();
    const url = document.getElementById('edit-link-url').value.trim();

    if (!title || !url || !isValidHttpUrl(url)) {
        showAlertModal("Chybƒõj√≠c√≠/neplatn√© √∫daje", "Zadejte platn√Ω n√°zev a URL (http:// nebo https://) pro odkaz.");
        return;
    }

    if (editingLinkIndex === -1) {
        externalLinksData.push({ title, url });
        showAlertModal("Odkaz p≈ôid√°n", `Odkaz "${title}" byl p≈ôid√°n.`);
    } else {
        externalLinksData[editingLinkIndex] = { title, url };
        showAlertModal("Odkaz upraven", `Odkaz "${title}" byl upraven.`);
    }
    
    saveToLocalStorage(STORAGE_KEYS.EXTERNAL_LINKS, externalLinksData); // Ulo≈æ√≠ lok√°lnƒõ
    // A tak√© na Firebase
    if (currentSupabaseUserId) {
        saveDataToFirebase();
    }
    renderExternalLinks();
    hideModal(document.getElementById('edit-link-modal'));
}
document.getElementById('save-edit-link-btn')?.addEventListener('click', saveEditedLink);
document.getElementById('cancel-edit-link-btn')?.addEventListener('click', () => hideModal(document.getElementById('edit-link-modal')));


async function deleteLink(index) {
    const linkToDelete = externalLinksData[index];
    const confirmed = await (window.showConfirmModal ?
        showConfirmModal("Smazat odkaz?", `Opravdu smazat odkaz "${linkToDelete.title}"?`) :
        confirm(`Smazat odkaz "${linkToDelete.title}"?`)
    );
    if (confirmed) {
        externalLinksData.splice(index, 1);
        saveToLocalStorage(STORAGE_KEYS.EXTERNAL_LINKS, externalLinksData); // Ulo≈æ√≠ lok√°lnƒõ
        // A tak√© na Firebase
        if (currentSupabaseUserId) {
            saveDataToFirebase();
        }
        renderExternalLinks();
    }
}

// --- Mod√°ln√≠ okna (z≈Øst√°vaj√≠ stejn√©) ---
function showModal(modalElement) {
    if(modalElement) modalElement.classList.add('visible');
}
function hideModal(modalElement) {
    if(modalElement) modalElement.classList.remove('visible');
}

const saveCodeModalEl = document.getElementById('save-code-modal');
const codeTitleInputEl = document.getElementById('code-title-input');
const confirmSaveCodeBtnEl = document.getElementById('confirm-save-code-btn');
const cancelSaveCodeBtnEl = document.getElementById('cancel-save-code-btn');

if(confirmSaveCodeBtnEl && codeTitleInputEl) {
    confirmSaveCodeBtnEl.addEventListener('click', () => {
        const title = codeTitleInputEl.value.trim();
        const editor = document.getElementById('html-editor');
        const code = editor ? editor.value : '';
        if (title && code) {
            saveHtmlCodeLocally(title, code);
            if(saveCodeModalEl) hideModal(saveCodeModalEl);
            codeTitleInputEl.value = '';
        } else {
            if(window.showAlertModal) showAlertModal("Chybƒõj√≠c√≠ √∫daje", "Zadejte n√°zev a ujistƒõte se, ≈æe k√≥d nen√≠ pr√°zdn√Ω.");
            else alert("Nelze ulo≈æit pr√°zdn√Ω k√≥d.");
        }
    });
}
if(cancelSaveCodeBtnEl) cancelSaveCodeBtnEl.addEventListener('click', () => {
    if(saveCodeModalEl) hideModal(saveCodeModalEl);
    if(codeTitleInputEl) codeTitleInputEl.value = '';
});

// Definice pro glob√°ln√≠ okna (z≈Øst√°vaj√≠ stejn√©)
if (!window.showAlertModal) {
    window.showAlertModal = (title, message) => {
        console.warn("Custom showAlertModal not fully initialized, using native alert.");
        return new Promise((resolve) => {
            alert(`${title}\n\n${message}`);
            resolve(true);
        });
    };
}
if (!window.showConfirmModal) {
    window.showConfirmModal = (title, message) => {
        console.warn("Custom showConfirmModal not fully initialized, using native confirm.");
        return new Promise((resolve) => {
            resolve(confirm(`${title}\n\n${message}`));
        });
    };
}

const alertModalEl = document.getElementById('alert-modal');
const alertModalTitleEl = document.getElementById('alert-modal-title');
const alertModalMessageEl = document.getElementById('alert-modal-message');
let alertModalOkBtnEl = document.getElementById('alert-modal-ok-btn');

if(alertModalEl && alertModalTitleEl && alertModalMessageEl && alertModalOkBtnEl) {
    window.showAlertModal = (title, message) => {
        return new Promise((resolve) => {
            alertModalTitleEl.textContent = title;
            alertModalMessageEl.textContent = message;
            
            const newOkBtn = alertModalOkBtnEl.cloneNode(true);
            alertModalOkBtnEl.parentNode.replaceChild(newOkBtn, alertModalOkBtnEl);
            alertModalOkBtnEl = newOkBtn;
            
            alertModalOkBtnEl.onclick = () => {
                hideModal(alertModalEl);
                resolve(true);
            };
            showModal(alertModalEl);
        });
    };
}


const confirmModalEl = document.getElementById('confirm-modal');
const confirmModalTitleEl = document.getElementById('confirm-modal-title');
const confirmModalMessageEl = document.getElementById('confirm-modal-message');
let confirmModalOkBtnEl = document.getElementById('confirm-modal-ok-btn');
let confirmModalCancelBtnEl = document.getElementById('confirm-modal-cancel-btn');

if(confirmModalEl && confirmModalTitleEl && confirmModalMessageEl && confirmModalOkBtnEl && confirmModalCancelBtnEl) {
    window.showConfirmModal = (title, message, buttonTexts = {}) => {
        return new Promise((resolve) => {
            confirmModalTitleEl.textContent = title;
            confirmModalMessageEl.textContent = message;

            const newOkBtn = confirmModalOkBtnEl.cloneNode(true);
            newOkBtn.textContent = buttonTexts.okText || 'Potvrdit';
            confirmModalOkBtnEl.parentNode.replaceChild(newOkBtn, confirmModalOkBtnEl);
            confirmModalOkBtnEl = newOkBtn;
            
            const newCancelBtn = confirmModalCancelBtnEl.cloneNode(true);
            newCancelBtn.textContent = buttonTexts.cancelText || 'Zru≈°it';
            confirmModalCancelBtnEl.parentNode.replaceChild(newCancelBtn, confirmModalCancelBtnEl);
            confirmModalCancelBtnEl = newCancelBtn;
            
            confirmModalOkBtnEl.onclick = () => {
                hideModal(confirmModalEl);
                resolve(true);
            };
            confirmModalCancelBtnEl.onclick = () => {
                hideModal(confirmModalEl);
                resolve(false);
            };
            showModal(confirmModalEl);
        });
    };
}

window.showSection = showSection;

// --- Nov√© funkce pro editaci portfolia (upravujeme pro Firebase) ---
let editingPortfolioItemId = null; // ID polo≈æky, kterou pr√°vƒõ editujeme

function editPortfolioItem(itemId) {
    editingPortfolioItemId = itemId;
    const item = document.querySelector(`.portfolio-item[data-item-id="${itemId}"]`);
    if (!item) return;

    document.getElementById('edit-portfolio-title').value = item.querySelector(`[data-editable="${itemId}-title"]`).textContent.trim();
    document.getElementById('edit-portfolio-desc-1').value = item.querySelector(`[data-editable="${itemId}-desc-1"]`).textContent.trim();
    
    const desc2Element = item.querySelector(`[data-editable="${itemId}-desc-2"]`);
    document.getElementById('edit-portfolio-desc-2').value = desc2Element ? desc2Element.textContent.trim() : '';

    const linkElement = item.querySelector(`[data-link-id="${itemId}-link"]`);
    document.getElementById('edit-portfolio-link-text').value = linkElement ? linkElement.childNodes[0].nodeValue.trim() : '';
    document.getElementById('edit-portfolio-link-url').value = linkElement ? linkElement.href : '';

    document.getElementById('delete-portfolio-btn').classList.remove('hidden');
    showModal(document.getElementById('edit-portfolio-modal'));
}

document.getElementById('save-edit-portfolio-btn')?.addEventListener('click', saveEditedPortfolioItem);
document.getElementById('cancel-edit-portfolio-btn')?.addEventListener('click', () => hideModal(document.getElementById('edit-portfolio-modal')));
document.getElementById('delete-portfolio-btn')?.addEventListener('click', deletePortfolioItem);
document.getElementById('add-portfolio-item-btn')?.addEventListener('click', addPortfolioItem);

function addPortfolioItem() {
    editingPortfolioItemId = null;
    document.getElementById('edit-portfolio-title').value = '';
    document.getElementById('edit-portfolio-desc-1').value = '';
    document.getElementById('edit-portfolio-desc-2').value = '';
    document.getElementById('edit-portfolio-link-text').value = '';
    document.getElementById('edit-portfolio-link-url').value = '';
    document.getElementById('delete-portfolio-btn').classList.add('hidden');
    showModal(document.getElementById('edit-portfolio-modal'));
}

function saveEditedPortfolioItem() {
    const title = document.getElementById('edit-portfolio-title').value.trim();
    const desc1 = document.getElementById('edit-portfolio-desc-1').value.trim();
    const desc2 = document.getElementById('edit-portfolio-desc-2').value.trim();
    const linkText = document.getElementById('edit-portfolio-link-text').value.trim();
    const linkUrl = document.getElementById('edit-portfolio-link-url').value.trim();

    if (!title || !desc1) {
        showAlertModal("Chybƒõj√≠c√≠ √∫daje", "Vypl≈àte pros√≠m n√°zev a prvn√≠ popis polo≈æky portfolia.");
        return;
    }
    if (linkUrl && !isValidHttpUrl(linkUrl)) {
        showAlertModal("Neplatn√° URL", "Zadejte platnou URL adresu pro odkaz (http:// nebo https://).");
        return;
    }

    const newId = editingPortfolioItemId || `portfolio-item-${Date.now()}`;
    
    editableContentData[`${newId}-title`] = title;
    editableContentData[`${newId}-desc-1`] = desc1;
    editableContentData[`${newId}-desc-2`] = desc2;
    editableContentData[`${newId}-link-text`] = linkText;
    editableContentData[`${newId}-link-url`] = linkUrl;

    if (!editingPortfolioItemId) {
        const portfolioContainer = document.querySelector('.portfolio-items');
        const newItemHtml = `
                <div class="portfolio-item" data-item-id="${newId}" style="background-color: #f9f9f9; padding: 1rem; border-radius: 4px; border: 1px solid #ddd; position: relative;">
                    <h3 data-editable="${newId}-title">${title}</h3>
                    <p data-editable="${newId}-desc-1">${desc1}</p>
                    ${desc2 ? `<p data-editable="${newId}-desc-2">${desc2}</p>` : ''}
                    <a href="${linkUrl || '#'}" class="button editable-link" data-link-id="${newId}-link" data-editable-link-text="${linkText || 'Zobrazit projekt &rarr;'}" target="_blank" rel="noopener noreferrer">
                        ${linkText || 'Zobrazit projekt &rarr;'}<i class="fas fa-edit edit-icon ${isEditMode ? '' : 'hidden'}"></i>
                    </a>
                    <div class="edit-controls ${isEditMode ? '' : 'hidden'}">
                        <button onclick="editPortfolioItem('${newId}')">Editovat</button>
                    </div>
                </div>
            `;
        portfolioContainer.insertAdjacentHTML('beforeend', newItemHtml);
        if (isEditMode) {
            const newlyAddedItem = portfolioContainer.lastElementChild;
            newlyAddedItem.querySelectorAll('[data-editable]').forEach(el => {
                el.setAttribute('contenteditable', 'true');
            });
        }
        showAlertModal("Polo≈æka p≈ôid√°na", `Nov√° polo≈æka portfolia "${title}" byla p≈ôid√°na.`);
    } else {
        applyEditableContent();
        showAlertModal("Polo≈æka upravena", `Polo≈æka portfolia "${title}" byla upravena.`);
    }

    saveToLocalStorage(STORAGE_KEYS.EDITABLE_CONTENT, editableContentData); // Ulo≈æ√≠ lok√°lnƒõ
    // A tak√© na Firebase
    if (currentSupabaseUserId) {
        saveDataToFirebase();
    }
    hideModal(document.getElementById('edit-portfolio-modal'));
    editingPortfolioItemId = null;
}

async function deletePortfolioItem() {
    if (!editingPortfolioItemId) return;

    const confirmed = await (window.showConfirmModal ?
        showConfirmModal("Smazat polo≈æku portfolia?", "Opravdu chcete smazat tuto polo≈æku z portfolia? Tato akce je nevratn√°!", { okText: 'Ano, smazat', cancelText: 'Zru≈°it' }) :
        confirm("Opravdu chcete smazat tuto polo≈æku z portfolia? Tato akce je nevratn√°!")
    );

    if (confirmed) {
        const itemElement = document.querySelector(`.portfolio-item[data-item-id="${editingPortfolioItemId}"]`);
        if (itemElement) {
            itemElement.remove();
            delete editableContentData[`${editingPortfolioItemId}-title`];
            delete editableContentData[`${editingPortfolioItemId}-desc-1`];
            delete editableContentData[`${editingPortfolioItemId}-desc-2`];
            delete editableContentData[`${editingPortfolioItemId}-link-text`];
            delete editableContentData[`${editingPortfolioItemId}-link-url`];
            saveToLocalStorage(STORAGE_KEYS.EDITABLE_CONTENT, editableContentData); // Ulo≈æ√≠ lok√°lnƒõ
            // A tak√© na Firebase
            if (currentSupabaseUserId) {
                saveDataToFirebase();
            }
            showAlertModal("Polo≈æka smaz√°na", "Polo≈æka portfolia byla √∫spƒõ≈°nƒõ smaz√°na.");
        } else {
            showAlertModal("Chyba", "Polo≈æka k smaz√°n√≠ nebyla nalezena.");
        }
        hideModal(document.getElementById('edit-portfolio-modal'));
        editingPortfolioItemId = null;
    }
}
// --- Pomocn√Ω script pro spr√°vu viditelnosti tlaƒç√≠tek ---
(function() {
    'use strict';
    
    // Funkce pro skryt√≠ tlaƒç√≠tek spr√°vy dat
    function hideDataManagementButtons() {
        const container = document.querySelector('.function-setupDataManagement');
        if (container) {
            container.style.display = 'none';
        }
    }
    
    // Funkce pro zobrazen√≠ tlaƒç√≠tek spr√°vy dat
    function showDataManagementButtons() {
        const container = document.querySelector('.function-setupDataManagement');
        if (container) {
            container.style.display = 'flex';
        }
    }
    
    // Sledov√°n√≠ zmƒõn na body elementu
    function observeEditMode() {
        const body = document.body;
        
        // MutationObserver pro sledov√°n√≠ zmƒõn t≈ô√≠d
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    if (body.classList.contains('edit-mode')) {
                        showDataManagementButtons();
                    } else {
                        hideDataManagementButtons();
                    }
                }
            });
        });
        
        // Spu≈°tƒõn√≠ observeru
        observer.observe(body, {
            attributes: true,
            attributeFilter: ['class']
        });
        
        // Kontrola souƒçasn√©ho stavu
        if (body.classList.contains('edit-mode')) {
            showDataManagementButtons();
        } else {
            hideDataManagementButtons();
        }
    }
    
    // Inicializace
    function initDataManagementVisibility() {
        hideDataManagementButtons();
        observeEditMode();
    }
    
    // Spu≈°tƒõn√≠ p≈ôi naƒçten√≠ DOM
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initDataManagementVisibility);
    } else {
        initDataManagementVisibility();
    }
    
    // Export funkc√≠ pro ruƒçn√≠ pou≈æit√≠
    window.hideDataManagementButtons = hideDataManagementButtons;
    window.showDataManagementButtons = showDataManagementButtons;
    
})();
    //tady je pomocn√≠ script pro heslo pred p≈ôechodem k p≈ôihl√°≈°en√≠ a registrace 

    // hypoteticky_lokalni_heslo_script_hardcoded_hashed_CUSTOM_MODAL.js (vlo≈æit do javascript.js)

(function() {
    'use strict';

    // !!! EXTR√âMNƒö D≈ÆLE≈ΩIT√â BEZPEƒåNOSTN√ç UPOZORNƒöN√ç !!!
    // Hashing sice skryje p≈Øvodn√≠ heslo ze zdrojov√©ho k√≥du,
    // ale proto≈æe hashing logika je klient-side, nen√≠ to nezniƒçiteln√° ochrana.
    // Zku≈°en√Ω √∫toƒçn√≠k by mohl hashe extrahovat a pokusit se je prolomit offline.
    // Pro skuteƒçn√© zabezpeƒçen√≠ je pot≈ôeba ovƒõ≈ôov√°n√≠ na serveru.
    const HARDCODED_ACCESS_PASSWORD_HASH = '256b5537a792c98a13c9b32bb6b6c90f0e63531fe77c3b4dee69ee1ca82c984b'; // <--- ZDE M√Å≈† SV≈ÆJ HASH

    const loginButton = document.getElementById('login-button'); 

    if (!loginButton) {
        console.warn("Gemini Helper: Tlaƒç√≠tko pro p≈ôihl√°≈°en√≠ (login-button) nebylo nalezeno. Pomocn√Ω script se nespust√≠.");
        return;
    }

    // P≈ôedpokl√°d√°me, ≈æe window.showModal, window.hideModal jsou glob√°lnƒõ dostupn√©
    // a ≈æe HTML pro modal s ID 'local-password-modal' a jeho elementy (input, buttons, error span) existuje.

    /**
     * Pomocn√° funkce pro hashov√°n√≠ textu (asynchronn√≠).
     * @param {string} text Text k zahashov√°n√≠.
     * @returns {Promise<string>} Hash textu v hex form√°tu.
     */
    async function hashString(text) {
        const textEncoder = new TextEncoder();
        const data = textEncoder.encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hexHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return hexHash;
    }

    /**
     * Funkce pro zobrazen√≠ vlastn√≠ho "prompt" modalu a z√≠sk√°n√≠ vstupu od u≈æivatele.
     * Vr√°t√≠ Promise, kter√° se vy≈ôe≈°√≠ zadan√Ωm heslem nebo null, pokud je zru≈°eno.
     * Tuto funkci jsme ji≈æ d≈ô√≠ve prob√≠rali a mƒõla by b√Ωt v tv√©m javascript.js,
     * pokud ne, tak je zde pro kompletnost.
     */
    function showCustomPromptModal(modalId, inputId, errorId = null) {
        return new Promise(resolve => {
            const modal = document.getElementById(modalId);
            const input = document.getElementById(inputId);
            // Selektory jsou specifick√©, aby se zabr√°nilo koliz√≠m s jin√Ωmi modaly
            const okBtn = modal.querySelector('#' + modalId + ' #local-password-ok-btn'); 
            const cancelBtn = modal.querySelector('#' + modalId + ' #local-password-cancel-btn'); 
            const errorEl = errorId ? document.getElementById(errorId) : null;

            if (!modal || !input || !okBtn || !cancelBtn) {
                console.error(`Chyba: Chyb√≠ HTML elementy pro vlastn√≠ prompt modal (${modalId}). Zkontrolujte ID.`);
                resolve(null);
                return;
            }

            input.value = ''; 
            if (errorEl) errorEl.textContent = ''; 

            const clearListeners = () => {
                okBtn.onclick = null;
                cancelBtn.onclick = null;
                input.removeEventListener('keydown', handleEnterKey);
            };

            const handleEnterKey = (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    okBtn.click(); 
                }
            };
            input.addEventListener('keydown', handleEnterKey);

            okBtn.onclick = () => {
                clearListeners();
                window.hideModal(modal); 
                resolve(input.value);
            };
            cancelBtn.onclick = () => {
                clearListeners();
                window.hideModal(modal); 
                resolve(null);
            };

            window.showModal(modal); 
            input.focus();
        });
    }

    /**
     * Hlavn√≠ funkce pro zpracov√°n√≠ pokusu o p≈ô√≠stup k p≈ôihla≈°ovac√≠mu/registraƒçn√≠mu formul√°≈ôi.
     * Ovƒõ≈ô√≠ heslo pomoc√≠ hashe a vlastn√≠ho modalu.
     */
    async function handleLocalAccessPasswordHashedCustomModal() {
        // Krok 1: Kontrola p≈ôihl√°≈°en√≠ p≈ôes Supabase
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (session && session.user) {
            console.log("Gemini Helper: U≈æivatel je ji≈æ p≈ôihl√°≈°en p≈ôes Supabase. Lok√°ln√≠ hardcoded heslo p≈ôeskoƒçeno.");
            window.showAuthModal(); 
            return;
        }

        // Krok 2: Zobrazit vlastn√≠ modal a vy≈æ√°dat heslo
        const enteredPassword = await showCustomPromptModal(
            'local-password-modal', 
            'local-password-input', 
            'local-password-error'  
        );
        
        // Krok 3: Ovƒõ≈ôit zadan√© heslo
        // Pokud u≈æivatel zru≈°il zad√°v√°n√≠ (enteredPassword je null)
        if (enteredPassword === null) {
            console.log("Gemini Helper: Zad√°n√≠ hesla zru≈°eno u≈æivatelem.");
            // Nechceme zobrazovat alert, kdy≈æ u≈æivatel zru≈°il.
            // Pokud by byla chyba v local-password-error, skryj ji.
            const errorEl = document.getElementById('local-password-error');
            if (errorEl) errorEl.textContent = ''; 
            return; // Konec funkce
        }

        const enteredPasswordHash = await hashString(enteredPassword); 
        
        if (enteredPasswordHash === HARDCODED_ACCESS_PASSWORD_HASH) {
            console.log("Gemini Helper: Lok√°ln√≠ heslo (hash) spr√°vnƒõ, p≈ô√≠stup povolen.");
            window.showAuthModal(); 
        } else {
            // Zobrazen√≠ chyby p≈ô√≠mo v modalu
            const errorEl = document.getElementById('local-password-error');
            if (errorEl) {
                errorEl.textContent = "Chybn√© heslo! Zkuste to znovu.";
                // Znovu zobrazit modal, aby u≈æivatel mohl zkusit znovu
                window.showModal(document.getElementById('local-password-modal'));
                document.getElementById('local-password-input').focus();
            } else {
                // Fallback, pokud error element neexistuje
                alert("Chybn√© heslo. P≈ô√≠stup zam√≠tnut.");
            }
            console.log("Gemini Helper: Lok√°ln√≠ heslo (hash) chybn√©, p≈ô√≠stup zam√≠tnut.");
        }
    }

    // Krok 4: P≈ôep√≠≈°eme onclick ud√°lost tlaƒç√≠tka "Upravit str√°nku"
    loginButton.onclick = handleLocalAccessPasswordHashedCustomModal;

})();

    </script>
</body>
</html>
